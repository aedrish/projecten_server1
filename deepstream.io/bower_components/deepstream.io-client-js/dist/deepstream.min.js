/*! deepstream.io-client-js 0.3.5 (c)2015 hoxton-one, with parts (c)2015 Joyent and contributers  @licence MIT*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.deepstream=e()}}(function(){var e;return function f(e,n,o){function d(t,l){if(!n[t]){if(!e[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);var p=new Error("Cannot find module '"+t+"'");throw p.code="MODULE_NOT_FOUND",p}var s=n[t]={exports:{}};e[t][0].call(s.exports,function(f){var n=e[t][1][f];return d(n?n:f)},s,s.exports,f,e,n,o)}return n[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,f,n){function o(e,f,n){function o(e,d){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,f(e),f=n):0!==o.count||i||f(null,d)}var i=!1;return n=n||d,o.count=e,0===e?f():o}function d(){}f.exports=o},{}],2:[function(e,f,n){f.exports=function(e,f,n){var o=e.byteLength;if(f=f||0,n=n||o,e.slice)return e.slice(f,n);if(0>f&&(f+=o),0>n&&(n+=o),n>o&&(n=o),f>=o||f>=n||0===o)return new ArrayBuffer(0);for(var d=new Uint8Array(e),i=new Uint8Array(n-f),t=f,l=0;n>t;t++,l++)i[l]=d[t];return i.buffer}},{}],3:[function(e,f,n){!function(e){"use strict";n.encode=function(f){var n,o=new Uint8Array(f),d=o.length,i="";for(n=0;d>n;n+=3)i+=e[o[n]>>2],i+=e[(3&o[n])<<4|o[n+1]>>4],i+=e[(15&o[n+1])<<2|o[n+2]>>6],i+=e[63&o[n+2]];return d%3===2?i=i.substring(0,i.length-1)+"=":d%3===1&&(i=i.substring(0,i.length-2)+"=="),i},n.decode=function(f){var n,o,d,i,t,l=.75*f.length,u=f.length,p=0;"="===f[f.length-1]&&(l--,"="===f[f.length-2]&&l--);var s=new ArrayBuffer(l),y=new Uint8Array(s);for(n=0;u>n;n+=4)o=e.indexOf(f[n]),d=e.indexOf(f[n+1]),i=e.indexOf(f[n+2]),t=e.indexOf(f[n+3]),y[p++]=o<<2|d>>4,y[p++]=(15&d)<<4|i>>2,y[p++]=(3&i)<<6|63&t;return s}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],4:[function(e,f,n){(function(e){function n(e,f){f=f||{};for(var n=new o,d=0;d<e.length;d++)n.append(e[d]);return f.type?n.getBlob(f.type):n.getBlob()}var o=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,d=function(){try{var e=new Blob(["hi"]);return 2==e.size}catch(f){return!1}}(),i=o&&o.prototype.append&&o.prototype.getBlob;f.exports=function(){return d?e.Blob:i?n:void 0}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,f,n){},{}],6:[function(e,f,n){function o(e){return e?d(e):void 0}function d(e){for(var f in o.prototype)e[f]=o.prototype[f];return e}f.exports=o,o.prototype.on=o.prototype.addEventListener=function(e,f){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(f),this},o.prototype.once=function(e,f){function n(){o.off(e,n),f.apply(this,arguments)}var o=this;return this._callbacks=this._callbacks||{},n.fn=f,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,f){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var o,d=0;d<n.length;d++)if(o=n[d],o===f||o.fn===f){n.splice(d,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var f=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var o=0,d=n.length;d>o;++o)n[o].apply(this,f)}return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],7:[function(e,f,n){f.exports=function(e,f){var n=function(){};n.prototype=f.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],8:[function(e,f,n){function o(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var e=arguments,f=this.useColors;if(e[0]=(f?"%c":"")+this.namespace+(f?" %c":" ")+e[0]+(f?"%c ":" ")+"+"+n.humanize(this.diff),!f)return e;var o="color: "+this.color;e=[e[0],o,"color: inherit"].concat(Array.prototype.slice.call(e,1));var d=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(d++,"%c"===e&&(i=d))}),e.splice(i,0,o),e}function i(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function t(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(f){}}function l(){var e;try{e=localStorage.debug}catch(f){}return e}n=f.exports=e("./debug"),n.log=i,n.formatArgs=d,n.save=t,n.load=l,n.useColors=o,n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(l())},{"./debug":9}],9:[function(e,f,n){function o(){return n.colors[s++%n.colors.length]}function d(e){function f(){}function d(){var e=d,f=+new Date,i=f-(p||f);e.diff=i,e.prev=p,e.curr=f,p=f,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=o());var t=Array.prototype.slice.call(arguments);t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&(t=["%o"].concat(t));var l=0;t[0]=t[0].replace(/%([a-z%])/g,function(f,o){if("%%"===f)return f;l++;var d=n.formatters[o];if("function"==typeof d){var i=t[l];f=d.call(e,i),t.splice(l,1),l--}return f}),"function"==typeof n.formatArgs&&(t=n.formatArgs.apply(e,t));var u=d.log||n.log||console.log.bind(console);u.apply(e,t)}f.enabled=!1,d.enabled=!0;var i=n.enabled(e)?d:f;return i.namespace=e,i}function i(e){n.save(e);for(var f=(e||"").split(/[\s,]+/),o=f.length,d=0;o>d;d++)f[d]&&(e=f[d].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function t(){n.enable("")}function l(e){var f,o;for(f=0,o=n.skips.length;o>f;f++)if(n.skips[f].test(e))return!1;for(f=0,o=n.names.length;o>f;f++)if(n.names[f].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}n=f.exports=d,n.coerce=u,n.disable=t,n.enable=i,n.enabled=l,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var p,s=0},{ms:27}],10:[function(e,f,n){f.exports=e("./lib/")},{"./lib/":11}],11:[function(e,f,n){f.exports=e("./socket"),f.exports.parser=e("engine.io-parser")},{"./socket":12,"engine.io-parser":20}],12:[function(e,f,n){(function(n){function o(e,f){if(!(this instanceof o))return new o(e,f);if(f=f||{},e&&"object"==typeof e&&(f=e,e=null),e&&(e=s(e),f.host=e.host,f.secure="https"==e.protocol||"wss"==e.protocol,f.port=e.port,e.query&&(f.query=e.query)),this.secure=null!=f.secure?f.secure:n.location&&"https:"==location.protocol,f.host){var d=f.host.split(":");f.hostname=d.shift(),d.length&&(f.port=d.pop())}this.agent=f.agent||!1,this.hostname=f.hostname||(n.location?location.hostname:"localhost"),this.port=f.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=f.query||{},"string"==typeof this.query&&(this.query=a.decode(this.query)),this.upgrade=!1!==f.upgrade,this.path=(f.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!f.forceJSONP,this.jsonp=!1!==f.jsonp,this.forceBase64=!!f.forceBase64,this.enablesXDR=!!f.enablesXDR,this.timestampParam=f.timestampParam||"t",this.timestampRequests=f.timestampRequests,this.transports=f.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=f.policyPort||843,this.rememberUpgrade=f.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=f.onlyBinaryUpgrades}function d(e){var f={};for(var n in e)e.hasOwnProperty(n)&&(f[n]=e[n]);return f}var i=e("./transports"),t=e("component-emitter"),l=e("debug")("engine.io-client:socket"),u=e("indexof"),p=e("engine.io-parser"),s=e("parseuri"),y=e("parsejson"),a=e("parseqs");f.exports=o,o.priorWebsocketSuccess=!1,t(o.prototype),o.protocol=p.protocol,o.Socket=o,o.Transport=e("./transport"),o.transports=e("./transports"),o.parser=e("engine.io-parser"),o.prototype.createTransport=function(e){l('creating transport "%s"',e);var f=d(this.query);f.EIO=p.protocol,f.transport=e,this.id&&(f.sid=this.id);var n=new i[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:f,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this});return n},o.prototype.open=function(){var e;if(this.rememberUpgrade&&o.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var f=this;return void setTimeout(function(){f.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},o.prototype.setTransport=function(e){l("setting transport %s",e.name);var f=this;this.transport&&(l("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){f.onDrain()}).on("packet",function(e){f.onPacket(e)}).on("error",function(e){f.onError(e)}).on("close",function(){f.onClose("transport close")})},o.prototype.probe=function(e){function f(){if(a.onlyBinaryUpgrades){var f=!this.supportsBinary&&a.transport.supportsBinary;y=y||f}y||(l('probe transport "%s" opened',e),s.send([{type:"ping",data:"probe"}]),s.once("packet",function(f){if(!y)if("pong"==f.type&&"probe"==f.data){if(l('probe transport "%s" pong',e),a.upgrading=!0,a.emit("upgrading",s),!s)return;o.priorWebsocketSuccess="websocket"==s.name,l('pausing current transport "%s"',a.transport.name),a.transport.pause(function(){y||"closed"!=a.readyState&&(l("changing transport and sending upgrade packet"),p(),a.setTransport(s),s.send([{type:"upgrade"}]),a.emit("upgrade",s),s=null,a.upgrading=!1,a.flush())})}else{l('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=s.name,a.emit("upgradeError",n)}}))}function n(){y||(y=!0,p(),s.close(),s=null)}function d(f){var o=new Error("probe error: "+f);o.transport=s.name,n(),l('probe transport "%s" failed because of error: %s',e,f),a.emit("upgradeError",o)}function i(){d("transport closed")}function t(){d("socket closed")}function u(e){s&&e.name!=s.name&&(l('"%s" works - aborting "%s"',e.name,s.name),n())}function p(){s.removeListener("open",f),s.removeListener("error",d),s.removeListener("close",i),a.removeListener("close",t),a.removeListener("upgrading",u)}l('probing transport "%s"',e);var s=this.createTransport(e,{probe:1}),y=!1,a=this;o.priorWebsocketSuccess=!1,s.once("open",f),s.once("error",d),s.once("close",i),this.once("close",t),this.once("upgrading",u),s.open()},o.prototype.onOpen=function(){if(l("socket open"),this.readyState="open",o.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){l("starting upgrade probes");for(var e=0,f=this.upgrades.length;f>e;e++)this.probe(this.upgrades[e])}},o.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(l('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(y(e.data));break;case"pong":this.setPing();break;case"error":var f=new Error("server error");f.code=e.data,this.emit("error",f);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else l('packet received with socket readyState "%s"',this.readyState)},o.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},o.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var f=this;f.pingTimeoutTimer=setTimeout(function(){"closed"!=f.readyState&&f.onClose("ping timeout")},e||f.pingInterval+f.pingTimeout)},o.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){l("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},o.prototype.ping=function(){this.sendPacket("ping")},o.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},o.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(l("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},o.prototype.write=o.prototype.send=function(e,f){return this.sendPacket("message",e,f),this},o.prototype.sendPacket=function(e,f,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var o={type:e,data:f};this.emit("packetCreate",o),this.writeBuffer.push(o),this.callbackBuffer.push(n),this.flush()}},o.prototype.close=function(){function e(){o.onClose("forced close"),l("socket closing - telling transport to close"),o.transport.close()}function f(){o.removeListener("upgrade",f),o.removeListener("upgradeError",f),e()}function n(){o.once("upgrade",f),o.once("upgradeError",f)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},o.prototype.onError=function(e){l("socket error %j",e),o.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},o.prototype.onClose=function(e,f){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){l('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,f)}},o.prototype.filterUpgrades=function(e){for(var f=[],n=0,o=e.length;o>n;n++)~u(this.transports,e[n])&&f.push(e[n]);return f}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":13,"./transports":14,"component-emitter":6,debug:8,"engine.io-parser":20,indexof:25,parsejson:28,parseqs:29,parseuri:30}],13:[function(e,f,n){function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR}var d=e("engine.io-parser"),i=e("component-emitter");f.exports=o,i(o.prototype),o.timestamps=0,o.prototype.onError=function(e,f){var n=new Error(e);return n.type="TransportError",n.description=f,this.emit("error",n),this},o.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var f=d.decodePacket(e,this.socket.binaryType);this.onPacket(f)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":6,"engine.io-parser":20}],14:[function(e,f,n){(function(f){function o(e){var n,o=!1,l=!1,u=!1!==e.jsonp;if(f.location){var p="https:"==location.protocol,s=location.port;s||(s=p?443:80),o=e.hostname!=location.hostname||s!=e.port,l=e.secure!=p}if(e.xdomain=o,e.xscheme=l,n=new d(e),"open"in n&&!e.forceJSONP)return new i(e);if(!u)throw new Error("JSONP disabled");return new t(e)}var d=e("xmlhttprequest"),i=e("./polling-xhr"),t=e("./polling-jsonp"),l=e("./websocket");n.polling=o,n.websocket=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":15,"./polling-xhr":16,"./websocket":18,xmlhttprequest:19}],15:[function(e,f,n){(function(n){function o(){}function d(e){i.call(this,e),this.query=this.query||{},l||(n.___eio||(n.___eio=[]),l=n.___eio),this.index=l.length;var f=this;l.push(function(e){f.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){f.script&&(f.script.onerror=o)},!1)}var i=e("./polling"),t=e("component-inherit");f.exports=d;var l,u=/\n/g,p=/\\n/g;t(d,i),d.prototype.supportsBinary=!1,d.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},d.prototype.doPoll=function(){var e=this,f=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),f.async=!0,f.src=this.uri(),f.onerror=function(f){e.onError("jsonp poll error",f)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(f,n),this.script=f;var o="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);o&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},d.prototype.doWrite=function(e,f){function n(){o(),f()}function o(){if(d.iframe)try{d.form.removeChild(d.iframe)}catch(e){d.onError("jsonp polling iframe removal error",e)}try{var f='<iframe src="javascript:0" name="'+d.iframeId+'">';i=document.createElement(f)}catch(e){i=document.createElement("iframe"),i.name=d.iframeId,i.src="javascript:0"}i.id=d.iframeId,d.form.appendChild(i),d.iframe=i}var d=this;if(!this.form){var i,t=document.createElement("form"),l=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;t.className="socketio",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.target=s,t.method="POST",t.setAttribute("accept-charset","utf-8"),l.name="d",t.appendChild(l),document.body.appendChild(t),this.form=t,this.area=l}this.form.action=this.uri(),o(),e=e.replace(p,"\\\n"),this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(y){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==d.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":17,"component-inherit":7}],16:[function(e,f,n){(function(n){function o(){}function d(e){if(u.call(this,e),n.location){var f="https:"==location.protocol,o=location.port;o||(o=f?443:80),this.xd=e.hostname!=n.location.hostname||o!=e.port,this.xs=e.secure!=f}}function i(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.create()}function t(){for(var e in i.requests)i.requests.hasOwnProperty(e)&&i.requests[e].abort()}var l=e("xmlhttprequest"),u=e("./polling"),p=e("component-emitter"),s=e("component-inherit"),y=e("debug")("engine.io-client:polling-xhr");f.exports=d,f.exports.Request=i,s(d,u),d.prototype.supportsBinary=!0,d.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,new i(e)},d.prototype.doWrite=function(e,f){var n="string"!=typeof e&&void 0!==e,o=this.request({method:"POST",data:e,isBinary:n}),d=this;o.on("success",f),o.on("error",function(e){d.onError("xhr post error",e)}),this.sendXhr=o},d.prototype.doPoll=function(){y("xhr poll");var e=this.request(),f=this;e.on("data",function(e){f.onData(e)}),e.on("error",function(e){f.onError("xhr poll error",e)}),this.pollXhr=e},p(i.prototype),i.prototype.create=function(){var e=this.xhr=new l({agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR}),f=this;try{if(y("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async),this.supportsBinary&&(e.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}"withCredentials"in e&&(e.withCredentials=!0),this.hasXDR()?(e.onload=function(){f.onLoad()},e.onerror=function(){f.onError(e.responseText)}):e.onreadystatechange=function(){4==e.readyState&&(200==e.status||1223==e.status?f.onLoad():setTimeout(function(){f.onError(e.status)},0))},y("xhr data %s",this.data),e.send(this.data)}catch(o){return void setTimeout(function(){f.onError(o)},0)}n.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},i.prototype.onError=function(e){this.emit("error",e),this.cleanup()},i.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.hasXDR()?this.xhr.onload=this.xhr.onerror=o:this.xhr.onreadystatechange=o;try{this.xhr.abort()}catch(e){}n.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var e;try{var f;try{f=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}e="application/octet-stream"===f?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},i.prototype.hasXDR=function(){return"undefined"!=typeof n.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},n.document&&(i.requestsCount=0,i.requests={},n.attachEvent?n.attachEvent("onunload",t):n.addEventListener&&n.addEventListener("beforeunload",t,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":17,"component-emitter":6,"component-inherit":7,debug:8,xmlhttprequest:19}],17:[function(e,f,n){function o(e){var f=e&&e.forceBase64;(!p||f)&&(this.supportsBinary=!1),d.call(this,e)}var d=e("../transport"),i=e("parseqs"),t=e("engine.io-parser"),l=e("component-inherit"),u=e("debug")("engine.io-client:polling");f.exports=o;var p=function(){var f=e("xmlhttprequest"),n=new f({xdomain:!1});return null!=n.responseType}();l(o,d),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(e){function f(){u("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(u("we are currently polling - waiting to pause"),o++,this.once("pollComplete",function(){u("pre-pause polling complete"),--o||f()})),this.writable||(u("we are currently writing - waiting to pause"),o++,this.once("drain",function(){u("pre-pause writing complete"),--o||f()}))}else f()},o.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(e){var f=this;u("polling got data %s",e);var n=function(e,n,o){return"opening"==f.readyState&&f.onOpen(),"close"==e.type?(f.onClose(),!1):void f.onPacket(e)};t.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function e(){u("writing close packet"),f.write([{type:"close"}])}var f=this;"open"==this.readyState?(u("transport open - closing"),e()):(u("transport not open - deferring close"),this.once("open",e))},o.prototype.write=function(e){var f=this;this.writable=!1;var n=function(){f.writable=!0,f.emit("drain")},f=this;t.encodePayload(e,this.supportsBinary,function(e){f.doWrite(e,n)})},o.prototype.uri=function(){var e=this.query||{},f=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+d.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"==f&&443!=this.port||"http"==f&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),f+"://"+this.hostname+n+this.path+e}},{"../transport":13,"component-inherit":7,debug:8,"engine.io-parser":20,parseqs:29,xmlhttprequest:19}],18:[function(e,f,n){function o(e){var f=e&&e.forceBase64;f&&(this.supportsBinary=!1),d.call(this,e)}var d=e("../transport"),i=e("engine.io-parser"),t=e("parseqs"),l=e("component-inherit"),u=e("debug")("engine.io-client:websocket"),p=e("ws");f.exports=o,l(o,d),o.prototype.name="websocket",o.prototype.supportsBinary=!0,o.prototype.doOpen=function(){if(this.check()){var e=this.uri(),f=void 0,n={agent:this.agent};this.ws=new p(e,f,n),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},o.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(f){e.onData(f.data)},this.ws.onerror=function(f){e.onError("websocket error",f)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(o.prototype.onData=function(e){var f=this;setTimeout(function(){d.prototype.onData.call(f,e)},0)}),o.prototype.write=function(e){function f(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var o=0,d=e.length;d>o;o++)i.encodePacket(e[o],this.supportsBinary,function(e){try{n.ws.send(e)}catch(f){u("websocket closed before onclose event")}});setTimeout(f,0)},o.prototype.onClose=function(){d.prototype.onClose.call(this)},o.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},o.prototype.uri=function(){var e=this.query||{},f=this.secure?"wss":"ws",n="";return this.port&&("wss"==f&&443!=this.port||"ws"==f&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),e=t.encode(e),e.length&&(e="?"+e),f+"://"+this.hostname+n+this.path+e},o.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===o.prototype.name)}},{"../transport":13,"component-inherit":7,debug:8,"engine.io-parser":20,parseqs:29,ws:40}],19:[function(e,f,n){var o=e("has-cors");f.exports=function(e){var f=e.xdomain,n=e.xscheme,d=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!f||o))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&d)return new XDomainRequest}catch(i){}if(!f)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(i){}}},{"has-cors":24}],20:[function(e,f,n){(function(f){function o(e,f,o){if(!f)return n.encodeBase64Packet(e,o);var d=e.data,i=new Uint8Array(d),t=new Uint8Array(1+d.byteLength);t[0]=c[e.type];for(var l=0;l<i.length;l++)t[l+1]=i[l];return o(t.buffer)}function d(e,f,o){if(!f)return n.encodeBase64Packet(e,o);var d=new FileReader;return d.onload=function(){e.data=d.result,n.encodePacket(e,f,!0,o)},d.readAsArrayBuffer(e.data)}function i(e,f,o){if(!f)return n.encodeBase64Packet(e,o);if(a)return d(e,f,o);var i=new Uint8Array(1);i[0]=c[e.type];var t=new w([i.buffer,e.data]);return o(t)}function t(e,f,n){for(var o=new Array(e.length),d=s(e.length,n),i=function(e,n,d){f(n,function(f,n){o[e]=n,d(f,o)})},t=0;t<e.length;t++)i(t,e[t],d)}var l=e("./keys"),u=e("arraybuffer.slice"),p=e("base64-arraybuffer"),s=e("after"),y=e("utf8"),a=navigator.userAgent.match(/Android/i);n.protocol=3;var c=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=l(c),m={type:"error",data:"parser error"},w=e("blob");n.encodePacket=function(e,n,d,t){"function"==typeof n&&(t=n,n=!1),"function"==typeof d&&(t=d,d=null);var l=void 0===e.data?void 0:e.data.buffer||e.data;if(f.ArrayBuffer&&l instanceof ArrayBuffer)return o(e,n,t);if(w&&l instanceof f.Blob)return i(e,n,t);var u=c[e.type];return void 0!==e.data&&(u+=d?y.encode(String(e.data)):String(e.data)),t(""+u)},n.encodeBase64Packet=function(e,o){var d="b"+n.packets[e.type];if(w&&e.data instanceof w){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];o(d+e)},i.readAsDataURL(e.data)}var t;try{t=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(l){for(var u=new Uint8Array(e.data),p=new Array(u.length),s=0;s<u.length;s++)p[s]=u[s];t=String.fromCharCode.apply(null,p)}return d+=f.btoa(t),o(d)},n.decodePacket=function(e,f,o){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),f);if(o)try{e=y.decode(e)}catch(d){return m}var i=e.charAt(0);return Number(i)==i&&r[i]?e.length>1?{type:r[i],data:e.substring(1)}:{type:r[i]}:m}var t=new Uint8Array(e),i=t[0],l=u(e,1);return w&&"blob"===f&&(l=new w([l])),{type:r[i],data:l}},n.decodeBase64Packet=function(e,n){var o=r[e.charAt(0)];if(!f.ArrayBuffer)return{type:o,data:{base64:!0,data:e.substr(1)}};var d=p.decode(e.substr(1));return"blob"===n&&w&&(d=new w([d])),{type:o,data:d}},n.encodePayload=function(e,f,o){function d(e){return e.length+":"+e}function i(e,o){n.encodePacket(e,f,!0,function(e){o(null,d(e))})}return"function"==typeof f&&(o=f,f=null),f?w&&!a?n.encodePayloadAsBlob(e,o):n.encodePayloadAsArrayBuffer(e,o):e.length?void t(e,i,function(e,f){return o(f.join(""))}):o("0:")},n.decodePayload=function(e,f,o){if("string"!=typeof e)return n.decodePayloadAsBinary(e,f,o);"function"==typeof f&&(o=f,f=null);var d;if(""==e)return o(m,0,1);for(var i,t,l="",u=0,p=e.length;p>u;u++){var s=e.charAt(u);if(":"!=s)l+=s;else{if(""==l||l!=(i=Number(l)))return o(m,0,1);if(t=e.substr(u+1,i),l!=t.length)return o(m,0,1);if(t.length){if(d=n.decodePacket(t,f,!0),m.type==d.type&&m.data==d.data)return o(m,0,1);var y=o(d,u+i,p);if(!1===y)return}u+=i,l=""}}return""!=l?o(m,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,f){function o(e,f){n.encodePacket(e,!0,!0,function(e){return f(null,e)})}return e.length?void t(e,o,function(e,n){var o=n.reduce(function(e,f){var n;return n="string"==typeof f?f.length:f.byteLength,e+n.toString().length+n+2},0),d=new Uint8Array(o),i=0;return n.forEach(function(e){var f="string"==typeof e,n=e;if(f){for(var o=new Uint8Array(e.length),t=0;t<e.length;t++)o[t]=e.charCodeAt(t);n=o.buffer}f?d[i++]=0:d[i++]=1;for(var l=n.byteLength.toString(),t=0;t<l.length;t++)d[i++]=parseInt(l[t]);d[i++]=255;for(var o=new Uint8Array(n),t=0;t<o.length;t++)d[i++]=o[t]}),f(d.buffer)}):f(new ArrayBuffer(0))},n.encodePayloadAsBlob=function(e,f){function o(e,f){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var o=new Uint8Array(e.length),d=0;d<e.length;d++)o[d]=e.charCodeAt(d);e=o.buffer,n[0]=0}for(var i=e instanceof ArrayBuffer?e.byteLength:e.size,t=i.toString(),l=new Uint8Array(t.length+1),d=0;d<t.length;d++)l[d]=parseInt(t[d]);if(l[t.length]=255,w){var u=new w([n.buffer,l.buffer,e]);f(null,u)}})}t(e,o,function(e,n){return f(new w(n))})},n.decodePayloadAsBinary=function(e,f,o){"function"==typeof f&&(o=f,f=null);for(var d=e,i=[],t=!1;d.byteLength>0;){for(var l=new Uint8Array(d),p=0===l[0],s="",y=1;255!=l[y];y++){if(s.length>310){t=!0;break}s+=l[y]}if(t)return o(m,0,1);d=u(d,2+s.length),s=parseInt(s);var a=u(d,0,s);
if(p)try{a=String.fromCharCode.apply(null,new Uint8Array(a))}catch(c){var r=new Uint8Array(a);a="";for(var y=0;y<r.length;y++)a+=String.fromCharCode(r[y])}i.push(a),d=u(d,s)}var w=i.length;i.forEach(function(e,d){o(n.decodePacket(e,f,!0),d,w)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":21,after:1,"arraybuffer.slice":2,"base64-arraybuffer":3,blob:4,utf8:37}],21:[function(e,f,n){f.exports=Object.keys||function(e){var f=[],n=Object.prototype.hasOwnProperty;for(var o in e)n.call(e,o)&&f.push(o);return f}},{}],22:[function(e,f,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function i(e){return"number"==typeof e}function t(e){return"object"==typeof e&&null!==e}function l(e){return void 0===e}f.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var f,n,o,i,u,p;if(this._events||(this._events={}),"error"===e&&(!this._events.error||t(this._events.error)&&!this._events.error.length)){if(f=arguments[1],f instanceof Error)throw f;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],l(n))return!1;if(d(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,i=new Array(o-1),u=1;o>u;u++)i[u-1]=arguments[u];n.apply(this,i)}else if(t(n)){for(o=arguments.length,i=new Array(o-1),u=1;o>u;u++)i[u-1]=arguments[u];for(p=n.slice(),o=p.length,u=0;o>u;u++)p[u].apply(this,i)}return!0},o.prototype.addListener=function(e,f){var n;if(!d(f))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,d(f.listener)?f.listener:f),this._events[e]?t(this._events[e])?this._events[e].push(f):this._events[e]=[this._events[e],f]:this._events[e]=f,t(this._events[e])&&!this._events[e].warned){var n;n=l(this._maxListeners)?o.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,f){function n(){this.removeListener(e,n),o||(o=!0,f.apply(this,arguments))}if(!d(f))throw TypeError("listener must be a function");var o=!1;return n.listener=f,this.on(e,n),this},o.prototype.removeListener=function(e,f){var n,o,i,l;if(!d(f))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,o=-1,n===f||d(n.listener)&&n.listener===f)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,f);else if(t(n)){for(l=i;l-->0;)if(n[l]===f||n[l].listener&&n[l].listener===f){o=l;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,f)}return this},o.prototype.removeAllListeners=function(e){var f,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(f in this._events)"removeListener"!==f&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],d(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){var f;return f=this._events&&this._events[e]?d(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.listenerCount=function(e,f){var n;return n=e._events&&e._events[f]?d(e._events[f])?1:e._events[f].length:0}},{}],23:[function(e,f,n){f.exports=function(){return this}()},{}],24:[function(e,f,n){var o=e("global");try{f.exports="XMLHttpRequest"in o&&"withCredentials"in new o.XMLHttpRequest}catch(d){f.exports=!1}},{global:23}],25:[function(e,f,n){var o=[].indexOf;f.exports=function(e,f){if(o)return e.indexOf(f);for(var n=0;n<e.length;++n)if(e[n]===f)return n;return-1}},{}],26:[function(e,f,n){"function"==typeof Object.create?f.exports=function(e,f){e.super_=f,e.prototype=Object.create(f.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(e,f){e.super_=f;var n=function(){};n.prototype=f.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],27:[function(e,f,n){function o(e){var f=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(f){var n=parseFloat(f[1]),o=(f[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"h":return n*p;case"minutes":case"minute":case"m":return n*u;case"seconds":case"second":case"s":return n*l;case"ms":return n}}}function d(e){return e>=s?Math.round(e/s)+"d":e>=p?Math.round(e/p)+"h":e>=u?Math.round(e/u)+"m":e>=l?Math.round(e/l)+"s":e+"ms"}function i(e){return t(e,s,"day")||t(e,p,"hour")||t(e,u,"minute")||t(e,l,"second")||e+" ms"}function t(e,f,n){return f>e?void 0:1.5*f>e?Math.floor(e/f)+" "+n:Math.ceil(e/f)+" "+n+"s"}var l=1e3,u=60*l,p=60*u,s=24*p,y=365.25*s;f.exports=function(e,f){return f=f||{},"string"==typeof e?o(e):f["long"]?i(e):d(e)}},{}],28:[function(e,f,n){(function(e){var n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,t=/^\s+/,l=/\s+$/;f.exports=function(f){return"string"==typeof f&&f?(f=f.replace(t,"").replace(l,""),e.JSON&&JSON.parse?JSON.parse(f):n.test(f.replace(o,"@").replace(d,"]").replace(i,""))?new Function("return "+f)():void 0):null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],29:[function(e,f,n){n.encode=function(e){var f="";for(var n in e)e.hasOwnProperty(n)&&(f.length&&(f+="&"),f+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return f},n.decode=function(e){for(var f={},n=e.split("&"),o=0,d=n.length;d>o;o++){var i=n[o].split("=");f[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return f}},{}],30:[function(e,f,n){var o=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];f.exports=function(e){var f=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var t=o.exec(e||""),l={},u=14;u--;)l[d[u]]=t[u]||"";return-1!=n&&-1!=i&&(l.source=f,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l}},{}],31:[function(e,f,n){function o(){}var d=f.exports={};d.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,f="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var o=[];if(f){var d=document.createElement("div"),i=new MutationObserver(function(){var e=o.slice();o.length=0,e.forEach(function(e){e()})});return i.observe(d,{attributes:!0}),function(e){o.length||d.setAttribute("yes","no"),o.push(e)}}return n?(window.addEventListener("message",function(e){var f=e.source;if((f===window||null===f)&&"process-tick"===e.data&&(e.stopPropagation(),o.length>0)){var n=o.shift();n()}},!0),function(e){o.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=o,d.addListener=o,d.once=o,d.off=o,d.removeListener=o,d.removeAllListeners=o,d.emit=o,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],32:[function(f,n,o){(function(f){!function(d){function i(e){throw RangeError(I[e])}function t(e,f){for(var n=e.length;n--;)e[n]=f(e[n]);return e}function l(e,f){return t(e.split(H),f).join(".")}function u(e){for(var f,n,o=[],d=0,i=e.length;i>d;)f=e.charCodeAt(d++),f>=55296&&56319>=f&&i>d?(n=e.charCodeAt(d++),56320==(64512&n)?o.push(((1023&f)<<10)+(1023&n)+65536):(o.push(f),d--)):o.push(f);return o}function p(e){return t(e,function(e){var f="";return e>65535&&(e-=65536,f+=L(e>>>10&1023|55296),e=56320|1023&e),f+=L(e)}).join("")}function s(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:k}function y(e,f){return e+22+75*(26>e)-((0!=f)<<5)}function a(e,f,n){var o=0;for(e=n?K(e/B):e>>1,e+=K(e/f);e>J*z>>1;o+=k)e=K(e/J);return K(o+(J+1)*e/(e+A))}function c(e){var f,n,o,d,t,l,u,y,c,r,m=[],w=e.length,b=0,g=D,x=C;for(n=e.lastIndexOf(E),0>n&&(n=0),o=0;n>o;++o)e.charCodeAt(o)>=128&&i("not-basic"),m.push(e.charCodeAt(o));for(d=n>0?n+1:0;w>d;){for(t=b,l=1,u=k;d>=w&&i("invalid-input"),y=s(e.charCodeAt(d++)),(y>=k||y>K((h-b)/l))&&i("overflow"),b+=y*l,c=x>=u?q:u>=x+z?z:u-x,!(c>y);u+=k)r=k-c,l>K(h/r)&&i("overflow"),l*=r;f=m.length+1,x=a(b-t,f,0==t),K(b/f)>h-g&&i("overflow"),g+=K(b/f),b%=f,m.splice(b++,0,g)}return p(m)}function r(e){var f,n,o,d,t,l,p,s,c,r,m,w,b,g,x,j=[];for(e=u(e),w=e.length,f=D,n=0,t=C,l=0;w>l;++l)m=e[l],128>m&&j.push(L(m));for(o=d=j.length,d&&j.push(E);w>o;){for(p=h,l=0;w>l;++l)m=e[l],m>=f&&p>m&&(p=m);for(b=o+1,p-f>K((h-n)/b)&&i("overflow"),n+=(p-f)*b,f=p,l=0;w>l;++l)if(m=e[l],f>m&&++n>h&&i("overflow"),m==f){for(s=n,c=k;r=t>=c?q:c>=t+z?z:c-t,!(r>s);c+=k)x=s-r,g=k-r,j.push(L(y(r+x%g,0))),s=K(x/g);j.push(L(y(s,0))),t=a(n,b,o==d),n=0,++o}++n,++f}return j.join("")}function m(e){return l(e,function(e){return F.test(e)?c(e.slice(4).toLowerCase()):e})}function w(e){return l(e,function(e){return G.test(e)?"xn--"+r(e):e})}var b="object"==typeof o&&o,g="object"==typeof n&&n&&n.exports==b&&n,x="object"==typeof f&&f;(x.global===x||x.window===x)&&(d=x);var j,v,h=2147483647,k=36,q=1,z=26,A=38,B=700,C=72,D=128,E="-",F=/^xn--/,G=/[^ -~]/,H=/\x2E|\u3002|\uFF0E|\uFF61/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},J=k-q,K=Math.floor,L=String.fromCharCode;if(j={version:"1.2.4",ucs2:{decode:u,encode:p},decode:c,encode:r,toASCII:w,toUnicode:m},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return j});else if(b&&!b.nodeType)if(g)g.exports=j;else for(v in j)j.hasOwnProperty(v)&&(b[v]=j[v]);else d.punycode=j}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],33:[function(e,f,n){"use strict";function o(e,f){return Object.prototype.hasOwnProperty.call(e,f)}f.exports=function(e,f,n,i){f=f||"&",n=n||"=";var t={};if("string"!=typeof e||0===e.length)return t;var l=/\+/g;e=e.split(f);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var p=e.length;u>0&&p>u&&(p=u);for(var s=0;p>s;++s){var y,a,c,r,m=e[s].replace(l,"%20"),w=m.indexOf(n);w>=0?(y=m.substr(0,w),a=m.substr(w+1)):(y=m,a=""),c=decodeURIComponent(y),r=decodeURIComponent(a),o(t,c)?d(t[c])?t[c].push(r):t[c]=[t[c],r]:t[c]=r}return t};var d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],34:[function(e,f,n){"use strict";function o(e,f){if(e.map)return e.map(f);for(var n=[],o=0;o<e.length;o++)n.push(f(e[o],o));return n}var d=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};f.exports=function(e,f,n,l){return f=f||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(t(e),function(t){var l=encodeURIComponent(d(t))+n;return i(e[t])?o(e[t],function(e){return l+encodeURIComponent(d(e))}).join(f):l+encodeURIComponent(d(e[t]))}).join(f):l?encodeURIComponent(d(l))+n+encodeURIComponent(d(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t=Object.keys||function(e){var f=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&f.push(n);return f}},{}],35:[function(e,f,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":33,"./encode":34}],36:[function(e,f,n){function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function d(e,f,n){if(e&&p(e)&&e instanceof o)return e;var d=new o;return d.parse(e,f,n),d}function i(e){return u(e)&&(e=d(e)),e instanceof o?e.format():o.prototype.format.call(e)}function t(e,f){return d(e,!1,!0).resolve(f)}function l(e,f){return e?d(e,!1,!0).resolveObject(f):f}function u(e){return"string"==typeof e}function p(e){return"object"==typeof e&&null!==e}function s(e){return null===e}function y(e){return null==e}var a=e("punycode");n.parse=d,n.resolve=t,n.resolveObject=l,n.format=i,n.Url=o;var c=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,m=["<",">",'"',"`"," ","\r","\n","	"],w=["{","}","|","\\","^","`"].concat(m),b=["'"].concat(w),g=["%","/","?",";","#"].concat(b),x=["/","?","#"],j=255,v=/^[a-z0-9A-Z_-]{0,63}$/,h=/^([a-z0-9A-Z_-]{0,63})(.*)$/,k={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},z={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},A=e("querystring");o.prototype.parse=function(e,f,n){if(!u(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e;o=o.trim();var d=c.exec(o);if(d){d=d[0];var i=d.toLowerCase();this.protocol=i,o=o.substr(d.length)}if(n||d||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var t="//"===o.substr(0,2);!t||d&&q[d]||(o=o.substr(2),this.slashes=!0)}if(!q[d]&&(t||d&&!z[d])){for(var l=-1,p=0;p<x.length;p++){var s=o.indexOf(x[p]);-1!==s&&(-1===l||l>s)&&(l=s)}var y,r;r=-1===l?o.lastIndexOf("@"):o.lastIndexOf("@",l),-1!==r&&(y=o.slice(0,r),o=o.slice(r+1),this.auth=decodeURIComponent(y)),l=-1;for(var p=0;p<g.length;p++){var s=o.indexOf(g[p]);-1!==s&&(-1===l||l>s)&&(l=s)}-1===l&&(l=o.length),this.host=o.slice(0,l),o=o.slice(l),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var w=this.hostname.split(/\./),p=0,B=w.length;B>p;p++){var C=w[p];if(C&&!C.match(v)){for(var D="",E=0,F=C.length;F>E;E++)D+=C.charCodeAt(E)>127?"x":C[E];if(!D.match(v)){var G=w.slice(0,p),H=w.slice(p+1),I=C.match(h);I&&(G.push(I[1]),H.unshift(I[2])),H.length&&(o="/"+H.join(".")+o),this.hostname=G.join(".");break}}}if(this.hostname.length>j?this.hostname="":this.hostname=this.hostname.toLowerCase(),!m){for(var J=this.hostname.split("."),K=[],p=0;p<J.length;++p){var L=J[p];K.push(L.match(/[^A-Za-z0-9_-]/)?"xn--"+a.encode(L):L)}this.hostname=K.join(".")}var M=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+M,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!k[i])for(var p=0,B=b.length;B>p;p++){var O=b[p],P=encodeURIComponent(O);P===O&&(P=escape(O)),o=o.split(O).join(P)}var Q=o.indexOf("#");-1!==Q&&(this.hash=o.substr(Q),o=o.slice(0,Q));var R=o.indexOf("?");if(-1!==R?(this.search=o.substr(R),this.query=o.substr(R+1),f&&(this.query=A.parse(this.query)),o=o.slice(0,R)):f&&(this.search="",this.query={}),o&&(this.pathname=o),z[i]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var M=this.pathname||"",L=this.search||"";this.path=M+L}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var f=this.protocol||"",n=this.pathname||"",o=this.hash||"",d=!1,i="";this.host?d=e+this.host:this.hostname&&(d=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(d+=":"+this.port)),this.query&&p(this.query)&&Object.keys(this.query).length&&(i=A.stringify(this.query));var t=this.search||i&&"?"+i||"";return f&&":"!==f.substr(-1)&&(f+=":"),this.slashes||(!f||z[f])&&d!==!1?(d="//"+(d||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):d||(d=""),o&&"#"!==o.charAt(0)&&(o="#"+o),t&&"?"!==t.charAt(0)&&(t="?"+t),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),t=t.replace("#","%23"),f+d+n+t+o},o.prototype.resolve=function(e){return this.resolveObject(d(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(u(e)){var f=new o;f.parse(e,!1,!0),e=f}var n=new o;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(f){"protocol"!==f&&(n[f]=e[f])}),z[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!z[e.protocol])return Object.keys(e).forEach(function(f){n[f]=e[f]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||q[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var i=n.pathname||"",t=n.search||"";n.path=i+t}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var l=n.pathname&&"/"===n.pathname.charAt(0),p=e.host||e.pathname&&"/"===e.pathname.charAt(0),a=p||l||n.host&&e.pathname,c=a,r=n.pathname&&n.pathname.split("/")||[],d=e.pathname&&e.pathname.split("/")||[],m=n.protocol&&!z[n.protocol];if(m&&(n.hostname="",n.port=null,n.host&&(""===r[0]?r[0]=n.host:r.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),a=a&&(""===d[0]||""===r[0])),p)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,r=d;else if(d.length)r||(r=[]),r.pop(),r=r.concat(d),n.search=e.search,n.query=e.query;else if(!y(e.search)){if(m){n.hostname=n.host=r.shift();var w=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;w&&(n.auth=w.shift(),n.host=n.hostname=w.shift())}return n.search=e.search,n.query=e.query,s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!r.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var b=r.slice(-1)[0],g=(n.host||e.host)&&("."===b||".."===b)||""===b,x=0,j=r.length;j>=0;j--)b=r[j],"."==b?r.splice(j,1):".."===b?(r.splice(j,1),x++):x&&(r.splice(j,1),x--);if(!a&&!c)for(;x--;x)r.unshift("..");!a||""===r[0]||r[0]&&"/"===r[0].charAt(0)||r.unshift(""),g&&"/"!==r.join("/").substr(-1)&&r.push("");var v=""===r[0]||r[0]&&"/"===r[0].charAt(0);if(m){n.hostname=n.host=v?"":r.length?r.shift():"";var w=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;w&&(n.auth=w.shift(),n.host=n.hostname=w.shift())}return a=a||n.host&&r.length,a&&!v&&r.unshift(""),r.length?n.pathname=r.join("/"):(n.pathname=null,n.path=null),s(n.pathname)&&s(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,f=r.exec(e);f&&(f=f[0],":"!==f&&(this.port=f.substr(1)),e=e.substr(0,e.length-f.length)),e&&(this.hostname=e)}},{punycode:32,querystring:35}],37:[function(f,n,o){(function(f){!function(d){function i(e){for(var f,n,o=[],d=0,i=e.length;i>d;)f=e.charCodeAt(d++),f>=55296&&56319>=f&&i>d?(n=e.charCodeAt(d++),56320==(64512&n)?o.push(((1023&f)<<10)+(1023&n)+65536):(o.push(f),d--)):o.push(f);return o}function t(e){for(var f,n=e.length,o=-1,d="";++o<n;)f=e[o],f>65535&&(f-=65536,d+=x(f>>>10&1023|55296),f=56320|1023&f),d+=x(f);return d}function l(e,f){return x(e>>f&63|128)}function u(e){if(0==(4294967168&e))return x(e);var f="";return 0==(4294965248&e)?f=x(e>>6&31|192):0==(4294901760&e)?(f=x(e>>12&15|224),f+=l(e,6)):0==(4292870144&e)&&(f=x(e>>18&7|240),f+=l(e,12),f+=l(e,6)),f+=x(63&e|128)}function p(e){for(var f,n=i(e),o=n.length,d=-1,t="";++d<o;)f=n[d],t+=u(f);return t}function s(){if(g>=b)throw Error("Invalid byte index");var e=255&w[g];if(g++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function y(){var e,f,n,o,d;if(g>b)throw Error("Invalid byte index");if(g==b)return!1;if(e=255&w[g],g++,0==(128&e))return e;if(192==(224&e)){var f=s();if(d=(31&e)<<6|f,d>=128)return d;throw Error("Invalid continuation byte")}if(224==(240&e)){if(f=s(),n=s(),d=(15&e)<<12|f<<6|n,d>=2048)return d;throw Error("Invalid continuation byte")}if(240==(248&e)&&(f=s(),n=s(),o=s(),d=(15&e)<<18|f<<12|n<<6|o,d>=65536&&1114111>=d))return d;throw Error("Invalid UTF-8 detected")}function a(e){w=i(e),b=w.length,g=0;for(var f,n=[];(f=y())!==!1;)n.push(f);return t(n)}var c="object"==typeof o&&o,r="object"==typeof n&&n&&n.exports==c&&n,m="object"==typeof f&&f;(m.global===m||m.window===m)&&(d=m);var w,b,g,x=String.fromCharCode,j={version:"2.0.0",encode:p,decode:a};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return j});else if(c&&!c.nodeType)if(r)r.exports=j;else{var v={},h=v.hasOwnProperty;for(var k in j)h.call(j,k)&&(c[k]=j[k])}else d.utf8=j}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(e,f,n){f.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],39:[function(e,f,n){(function(f,o){function d(e,f){var o={seen:[],stylize:t};return arguments.length>=3&&(o.depth=arguments[2]),arguments.length>=4&&(o.colors=arguments[3]),m(f)?o.showHidden=f:f&&n._extend(o,f),v(o.showHidden)&&(o.showHidden=!1),v(o.depth)&&(o.depth=2),v(o.colors)&&(o.colors=!1),v(o.customInspect)&&(o.customInspect=!0),o.colors&&(o.stylize=i),u(o,e,o.depth)}function i(e,f){var n=d.styles[f];return n?"["+d.colors[n][0]+"m"+e+"["+d.colors[n][1]+"m":e}function t(e,f){return e}function l(e){var f={};return e.forEach(function(e,n){f[e]=!0}),f}function u(e,f,o){if(e.customInspect&&f&&A(f.inspect)&&f.inspect!==n.inspect&&(!f.constructor||f.constructor.prototype!==f)){var d=f.inspect(o,e);return x(d)||(d=u(e,d,o)),d}var i=p(e,f);if(i)return i;var t=Object.keys(f),m=l(t);if(e.showHidden&&(t=Object.getOwnPropertyNames(f)),z(f)&&(t.indexOf("message")>=0||t.indexOf("description")>=0))return s(f);if(0===t.length){if(A(f)){var w=f.name?": "+f.name:"";return e.stylize("[Function"+w+"]","special")}if(h(f))return e.stylize(RegExp.prototype.toString.call(f),"regexp");if(q(f))return e.stylize(Date.prototype.toString.call(f),"date");if(z(f))return s(f)}var b="",g=!1,j=["{","}"];if(r(f)&&(g=!0,j=["[","]"]),A(f)){var v=f.name?": "+f.name:"";b=" [Function"+v+"]"}if(h(f)&&(b=" "+RegExp.prototype.toString.call(f)),q(f)&&(b=" "+Date.prototype.toUTCString.call(f)),z(f)&&(b=" "+s(f)),0===t.length&&(!g||0==f.length))return j[0]+b+j[1];if(0>o)return h(f)?e.stylize(RegExp.prototype.toString.call(f),"regexp"):e.stylize("[Object]","special");e.seen.push(f);var k;return k=g?y(e,f,o,m,t):t.map(function(n){return a(e,f,o,m,n,g)}),e.seen.pop(),c(k,b,j)}function p(e,f){if(v(f))return e.stylize("undefined","undefined");if(x(f)){var n="'"+JSON.stringify(f).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(f)?e.stylize(""+f,"number"):m(f)?e.stylize(""+f,"boolean"):w(f)?e.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function y(e,f,n,o,d){for(var i=[],t=0,l=f.length;l>t;++t)F(f,String(t))?i.push(a(e,f,n,o,String(t),!0)):i.push("");return d.forEach(function(d){d.match(/^\d+$/)||i.push(a(e,f,n,o,d,!0))}),i}function a(e,f,n,o,d,i){var t,l,p;if(p=Object.getOwnPropertyDescriptor(f,d)||{value:f[d]},p.get?l=p.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):p.set&&(l=e.stylize("[Setter]","special")),F(o,d)||(t="["+d+"]"),l||(e.seen.indexOf(p.value)<0?(l=w(n)?u(e,p.value,null):u(e,p.value,n-1),l.indexOf("\n")>-1&&(l=i?l.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+l.split("\n").map(function(e){return"   "+e}).join("\n"))):l=e.stylize("[Circular]","special")),v(t)){if(i&&d.match(/^\d+$/))return l;t=JSON.stringify(""+d),t.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(t=t.substr(1,t.length-2),t=e.stylize(t,"name")):(t=t.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t=e.stylize(t,"string"))}return t+": "+l}function c(e,f,n){var o=0,d=e.reduce(function(e,f){return o++,f.indexOf("\n")>=0&&o++,e+f.replace(/\u001b\[\d\d?m/g,"").length+1},0);return d>60?n[0]+(""===f?"":f+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+f+" "+e.join(", ")+" "+n[1]}function r(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function w(e){return null===e}function b(e){return null==e}function g(e){return"number"==typeof e}function x(e){return"string"==typeof e}function j(e){return"symbol"==typeof e}function v(e){return void 0===e}function h(e){return k(e)&&"[object RegExp]"===C(e)}function k(e){return"object"==typeof e&&null!==e}function q(e){return k(e)&&"[object Date]"===C(e)}function z(e){return k(e)&&("[object Error]"===C(e)||e instanceof Error)}function A(e){return"function"==typeof e}function B(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function C(e){return Object.prototype.toString.call(e)}function D(e){return 10>e?"0"+e.toString(10):e.toString(10)}function E(){var e=new Date,f=[D(e.getHours()),D(e.getMinutes()),D(e.getSeconds())].join(":");return[e.getDate(),J[e.getMonth()],f].join(" ")}function F(e,f){return Object.prototype.hasOwnProperty.call(e,f)}var G=/%[sdj%]/g;n.format=function(e){if(!x(e)){for(var f=[],n=0;n<arguments.length;n++)f.push(d(arguments[n]));return f.join(" ")}for(var n=1,o=arguments,i=o.length,t=String(e).replace(G,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(f){return"[Circular]"}default:return e}}),l=o[n];i>n;l=o[++n])t+=w(l)||!k(l)?" "+l:" "+d(l);return t},n.deprecate=function(e,d){function i(){if(!t){if(f.throwDeprecation)throw new Error(d);f.traceDeprecation?console.trace(d):console.error(d),t=!0}return e.apply(this,arguments)}if(v(o.process))return function(){return n.deprecate(e,d).apply(this,arguments)};if(f.noDeprecation===!0)return e;var t=!1;return i};var H,I={};n.debuglog=function(e){if(v(H)&&(H=f.env.NODE_DEBUG||""),e=e.toUpperCase(),!I[e])if(new RegExp("\\b"+e+"\\b","i").test(H)){var o=f.pid;I[e]=function(){var f=n.format.apply(n,arguments);console.error("%s %d: %s",e,o,f)}}else I[e]=function(){};return I[e]},n.inspect=d,d.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=r,n.isBoolean=m,n.isNull=w,n.isNullOrUndefined=b,n.isNumber=g,n.isString=x,n.isSymbol=j,n.isUndefined=v,n.isRegExp=h,n.isObject=k,n.isDate=q,n.isError=z,n.isFunction=A,n.isPrimitive=B,n.isBuffer=e("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",E(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,f){if(!f||!k(f))return e;for(var n=Object.keys(f),o=n.length;o--;)e[n[o]]=f[n[o]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":38,_process:31,inherits:26}],40:[function(e,f,n){function o(e,f,n){var o;return o=f?new i(e,f):new i(e)}var d=function(){return this}(),i=d.WebSocket||d.MozWebSocket;f.exports=i?o:null,i&&(o.prototype=i.prototype)},{}],41:[function(e,f,n){var o=e("./constants/constants"),d=e("component-emitter"),i=e("./message/connection"),t=e("./event/event-handler"),l=e("./rpc/rpc-handler"),u=e("./record/record-handler"),p=e("./webrtc/webrtc-handler"),s=e("./default-options"),y=function(e,f){this._url=e,this._options=this._getOptions(f||{}),this._connection=new i(this,this._url,this._options),this.event=new t(this._options,this._connection),this.rpc=new l(this._options,this._connection,this),this.record=new u(this._options,this._connection,this),this.webrtc=new p(this._options,this._connection,this),this._messageCallbacks={},this._messageCallbacks[o.TOPIC.WEBRTC]=this.webrtc._$handle.bind(this.webrtc),this._messageCallbacks[o.TOPIC.EVENT]=this.event._$handle.bind(this.event),this._messageCallbacks[o.TOPIC.RPC]=this.rpc._$handle.bind(this.rpc),this._messageCallbacks[o.TOPIC.RECORD]=this.record._$handle.bind(this.record),this._messageCallbacks[o.TOPIC.ERROR]=this._onErrorMessage.bind(this)};d(y.prototype),y.prototype.login=function(e,f){return this._connection.authenticate(e||{},f),this},y.prototype.close=function(){this._connection.close()},y.prototype.getConnectionState=function(){return this._connection.getState()},y.prototype.getUid=function(){var e=(new Date).getTime().toString(36),f=(1e16*Math.random()).toString(36).replace(".","");return e+"-"+f},y.prototype._$onMessage=function(e){this._messageCallbacks[e.topic]?this._messageCallbacks[e.topic](e):this._$onError(e.topic,e.action,"received message for unknown topic "+e.topic),e.action!==o.ACTIONS.ERROR||e.processedError||this._$onError(e.topic,e.action,e.data[0])},y.prototype._$onError=function(e,f,n){var d;if((f===o.EVENT.ACK_TIMEOUT||f===o.EVENT.RESPONSE_TIMEOUT)&&this.getConnectionState()===o.CONNECTION_STATE.AWAITING_AUTHENTICATION&&(d="Your message timed out because you're not authenticated. Have you called login()?",setTimeout(this._$onError.bind(this,o.EVENT.NOT_AUTHENTICATED,o.TOPIC.ERROR,d),1)),!this.hasListeners("error"))throw console.log("--- You can catch all deepstream errors by subscribing to the error event ---"),d=f+": "+n,e&&(d+=" ("+e+")"),new Error(d);this.emit("error",n,f,e),this.emit(f,e,n)},y.prototype._onErrorMessage=function(e){this._$onError(e.topic,e.data[0],e.data[1])},y.prototype._getOptions=function(e){var f,n={};for(f in s)n[f]=e[f]||s[f];return n},f.exports=function(e,f){return new y(e,f)}},{"./constants/constants":42,"./default-options":43,"./event/event-handler":44,"./message/connection":45,"./record/record-handler":51,"./rpc/rpc-handler":53,"./webrtc/webrtc-handler":62,"component-emitter":6}],42:[function(e,f,n){n.CONNECTION_STATE={},n.CONNECTION_STATE.CLOSED="CLOSED",n.CONNECTION_STATE.AWAITING_AUTHENTICATION="AWAITING_AUTHENTICATION",n.CONNECTION_STATE.AUTHENTICATING="AUTHENTICATING",n.CONNECTION_STATE.OPEN="OPEN",n.CONNECTION_STATE.ERROR="ERROR",n.CONNECTION_STATE.RECONNECTING="RECONNECTING",n.MESSAGE_SEPERATOR=String.fromCharCode(30),n.MESSAGE_PART_SEPERATOR=String.fromCharCode(31),n.TYPES={},n.TYPES.STRING="S",n.TYPES.OBJECT="O",n.TYPES.NUMBER="N",n.TYPES.NULL="L",n.TYPES.TRUE="T",n.TYPES.FALSE="F",n.TYPES.UNDEFINED="U",n.TOPIC={},n.TOPIC.AUTH="A",n.TOPIC.ERROR="X",n.TOPIC.EVENT="E",n.TOPIC.RECORD="R",n.TOPIC.RPC="P",n.TOPIC.WEBRTC="W",n.TOPIC.PRIVATE="PRIVATE/",n.EVENT={},n.EVENT.CONNECTION_ERROR="connectionError",n.EVENT.CONNECTION_STATE_CHANGED="connectionStateChanged",
n.EVENT.ACK_TIMEOUT="ACK_TIMEOUT",n.EVENT.RESPONSE_TIMEOUT="RESPONSE_TIMEOUT",n.EVENT.UNSOLICITED_MESSAGE="UNSOLICITED_MESSAGE",n.EVENT.MESSAGE_PARSE_ERROR="MESSAGE_PARSE_ERROR",n.EVENT.VERSION_EXISTS="VERSION_EXISTS",n.EVENT.NOT_AUTHENTICATED="NOT_AUTHENTICATED",n.EVENT.LISTENER_EXISTS="LISTENER_EXISTS",n.EVENT.NOT_LISTENING="NOT_LISTENING",n.EVENT.TOO_MANY_AUTH_ATTEMPTS="TOO_MANY_AUTH_ATTEMPTS",n.EVENT.IS_CLOSED="IS_CLOSED",n.EVENT.UNKNOWN_CALLEE="UNKNOWN_CALLEE",n.ACTIONS={},n.ACTIONS.ACK="A",n.ACTIONS.READ="R",n.ACTIONS.CREATE="C",n.ACTIONS.UPDATE="U",n.ACTIONS.PATCH="P",n.ACTIONS.DELETE="D",n.ACTIONS.SUBSCRIBE="S",n.ACTIONS.UNSUBSCRIBE="US",n.ACTIONS.INVOKE="I",n.ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND="SP",n.ACTIONS.SUBSCRIPTION_FOR_PATTERN_REMOVED="SR",n.ACTIONS.LISTEN="L",n.ACTIONS.UNLISTEN="UL",n.ACTIONS.PROVIDER_UPDATE="PU",n.ACTIONS.QUERY="Q",n.ACTIONS.CREATEORREAD="CR",n.ACTIONS.EVENT="EVT",n.ACTIONS.ERROR="E",n.ACTIONS.REQUEST="REQ",n.ACTIONS.RESPONSE="RES",n.ACTIONS.REJECTION="REJ",n.ACTIONS.WEBRTC_REGISTER_CALLEE="RC",n.ACTIONS.WEBRTC_UNREGISTER_CALLEE="URC",n.ACTIONS.WEBRTC_OFFER="OF",n.ACTIONS.WEBRTC_ANSWER="AN",n.ACTIONS.WEBRTC_ICE_CANDIDATE="IC",n.ACTIONS.WEBRTC_CALL_DECLINED="CD",n.ACTIONS.WEBRTC_CALL_ENDED="CE",n.ACTIONS.WEBRTC_LISTEN_FOR_CALLEES="LC",n.ACTIONS.WEBRTC_UNLISTEN_FOR_CALLEES="ULC",n.ACTIONS.WEBRTC_ALL_CALLEES="WAC",n.ACTIONS.WEBRTC_CALLEE_ADDED="WCA",n.ACTIONS.WEBRTC_CALLEE_REMOVED="WCR",n.ACTIONS.WEBRTC_IS_ALIVE="WIA",n.CALL_STATE={},n.CALL_STATE.INITIAL="INITIAL",n.CALL_STATE.CONNECTING="CONNECTING",n.CALL_STATE.ESTABLISHED="ESTABLISHED",n.CALL_STATE.ACCEPTED="ACCEPTED",n.CALL_STATE.DECLINED="DECLINED",n.CALL_STATE.ENDED="ENDED",n.CALL_STATE.ERROR="ERROR"},{}],43:[function(e,f,n){f.exports={recordPersistDefault:!0,reconnectIntervalIncrement:4e3,maxReconnectAttempts:5,rpcAckTimeout:6e3,rpcResponseTimeout:1e4,subscriptionTimeout:2e3,maxMessagesPerPacket:100,timeBetweenSendingQueuedPackages:16,recordReadAckTimeout:1e3,recordReadTimeout:3e3,recordDeleteTimeout:3e3,calleeAckTimeout:3e3,rtcPeerConnectionConfig:{iceServers:[{url:"stun:stun.services.mozilla.com"},{url:"stun:stun.l.google.com:19302"}]},agent:!1,upgrade:!0,forceJSONP:!1,jsonp:!0,forceBase64:!1,enablesXDR:!1,timestampRequests:!1,timestampParam:"t",policyPort:843,path:"/engine.io",transports:["polling","websocket"],rememberUpgrade:!1}},{}],44:[function(e,f,n){var o=e("../message/message-builder"),d=e("../message/message-parser"),i=e("../constants/constants"),t=e("../utils/listener"),l=e("component-emitter"),u=function(e,f){this._options=e,this._connection=f,this._emitter=new l,this._listener={}};u.prototype.subscribe=function(e,f){this._emitter.hasListeners(e)||this._connection.sendMsg(i.TOPIC.EVENT,i.ACTIONS.SUBSCRIBE,[e]),this._emitter.on(e,f)},u.prototype.unsubscribe=function(e,f){this._emitter.off(e,f),this._emitter.hasListeners(e)||this._connection.sendMsg(i.TOPIC.EVENT,i.ACTIONS.UNSUBSCRIBE,[e])},u.prototype.emit=function(e,f){this._connection.sendMsg(i.TOPIC.EVENT,i.ACTIONS.EVENT,[e,o.typed(f)]),this._emitter.emit(e,f)},u.prototype.listen=function(e,f){this._listener[e]?this._client._$onError(i.TOPIC.EVENT,i.EVENT.LISTENER_EXISTS,e):this._listener[e]=new t(i.TOPIC.EVENT,e,f,this._options,this._client,this._connection)},u.prototype.unlisten=function(e){this._listener[e]?(this._listener[e].destroy(),delete this._listener[e]):this._client._$onError(i.TOPIC.EVENT,i.EVENT.NOT_LISTENING,e)},u.prototype._$handle=function(e){var f;e.action===i.ACTIONS.EVENT&&(e.data&&2===e.data.length?this._emitter.emit(e.data[0],d.convertTyped(e.data[1])):this._emitter.emit(e.data[0])),f=e.action===i.ACTIONS.ACK?e.data[1]:e.data[0],this._listener[f]&&this._listener[f]._$onMessage(e)},f.exports=u},{"../constants/constants":42,"../message/message-builder":46,"../message/message-parser":47,"../utils/listener":58,"component-emitter":6}],45:[function(e,f,n){var o=e("engine.io-client"),d=e("./message-parser"),i=e("./message-builder"),t=e("../tcp/tcp-connection"),l=e("../utils/utils"),u=e("../constants/constants"),p=function(e,f,n){this._client=e,this._url=f,this._options=n,this._authParams=null,this._authCallback=null,this._deliberateClose=!1,this._tooManyAuthAttempts=!1,this._queuedMessages=[],this._reconnectTimeout=null,this._reconnectionAttempt=0,this._currentPacketMessageCount=0,this._sendNextPacketTimeout=null,this._currentMessageResetTimeout=null,this._endpoint=null,this._state=u.CONNECTION_STATE.CLOSED,this._createEndpoint()};p.prototype.getState=function(){return this._state},p.prototype.authenticate=function(e,f){return this._tooManyAuthAttempts?void this._client._$onError(u.TOPIC.ERROR,u.EVENT.IS_CLOSED,"this client's connection was closed"):this._deliberateClose===!0&&this._state===u.CONNECTION_STATE.CLOSED?(this._createEndpoint(),this._deliberateClose=!1,void this._client.once(u.EVENT.CONNECTION_STATE_CHANGED,this.authenticate.bind(e,f))):(this._authParams=e,this._authCallback=f,void(this._state===u.CONNECTION_STATE.AWAITING_AUTHENTICATION&&this._sendAuthParams()))},p.prototype.sendMsg=function(e,f,n){this.send(i.getMsg(e,f,n))},p.prototype.send=function(e){this._queuedMessages.push(e),this._currentPacketMessageCount++,null===this._currentMessageResetTimeout&&(this._currentMessageResetTimeout=l.nextTick(this._resetCurrentMessageCount.bind(this))),this._state===u.CONNECTION_STATE.OPEN&&this._queuedMessages.length<this._options.maxMessagesPerPacket&&this._currentPacketMessageCount<this._options.maxMessagesPerPacket?this._sendQueuedMessages():null===this._sendNextPacketTimeout&&this._queueNextPacket()},p.prototype.close=function(){this._deliberateClose=!0,this._endpoint.close()},p.prototype._createEndpoint=function(){l.isNode()?this._endpoint=new t(this._url):this._endpoint=o(this._url,this._options),this._endpoint.on("open",this._onOpen.bind(this)),this._endpoint.on("error",this._onError.bind(this)),this._endpoint.on("close",this._onClose.bind(this)),this._endpoint.on("message",this._onMessage.bind(this))},p.prototype._resetCurrentMessageCount=function(){this._currentPacketMessageCount=0,this._currentMessageResetTimeout=null},p.prototype._sendQueuedMessages=function(){if(this._state===u.CONNECTION_STATE.OPEN){if(0===this._queuedMessages.length)return void(this._sendNextPacketTimeout=null);var e=this._queuedMessages.splice(0,this._options.maxMessagesPerPacket).join("");0!==this._queuedMessages.length?this._queueNextPacket():this._sendNextPacketTimeout=null,this._endpoint.send(e)}},p.prototype._queueNextPacket=function(){var e=this._sendQueuedMessages.bind(this),f=this._options.timeBetweenSendingQueuedPackages;this._sendNextPacketTimeout=setTimeout(e,f)},p.prototype._sendAuthParams=function(){this._setState(u.CONNECTION_STATE.AUTHENTICATING);var e=i.getMsg(u.TOPIC.AUTH,u.ACTIONS.REQUEST,[this._authParams]);this._endpoint.send(e)},p.prototype._onOpen=function(){this._clearReconnect(),this._setState(u.CONNECTION_STATE.AWAITING_AUTHENTICATION),this._authParams&&this._sendAuthParams()},p.prototype._onError=function(e){this._setState(u.CONNECTION_STATE.ERROR),setTimeout(function(){this._client._$onError(null,u.EVENT.CONNECTION_ERROR,e.toString())}.bind(this),1)},p.prototype._onClose=function(){this._deliberateClose===!0?this._setState(u.CONNECTION_STATE.CLOSED):this._tryReconnect()},p.prototype._onMessage=function(e){var f,n=d.parse(e,this._client);for(f=0;f<n.length;f++)null!==n[f]&&(n[f].topic===u.TOPIC.AUTH?this._handleAuthResponse(n[f]):this._client._$onMessage(n[f]))},p.prototype._handleAuthResponse=function(e){e.action===u.ACTIONS.ERROR?(e.data[0]===u.EVENT.TOO_MANY_AUTH_ATTEMPTS?(this._deliberateClose=!0,this._tooManyAuthAttempts=!0):this._setState(u.CONNECTION_STATE.AWAITING_AUTHENTICATION),this._authCallback&&this._authCallback(!1,e.data[0],e.data[1])):e.action===u.ACTIONS.ACK&&(this._setState(u.CONNECTION_STATE.OPEN),this._authCallback&&this._authCallback(!0),this._sendQueuedMessages())},p.prototype._setState=function(e){this._state=e,this._client.emit(u.EVENT.CONNECTION_STATE_CHANGED,e)},p.prototype._tryReconnect=function(){null===this._reconnectTimeout&&(this._reconnectionAttempt<this._options.maxReconnectAttempts?(this._setState(u.CONNECTION_STATE.RECONNECTING),this._reconnectTimeout=setTimeout(this._tryOpen.bind(this),this._options.reconnectIntervalIncrement*this._reconnectionAttempt),this._reconnectionAttempt++):(this._clearReconnect(),this.close()))},p.prototype._tryOpen=function(){this._endpoint.open(),this._reconnectTimeout=null},p.prototype._clearReconnect=function(){clearTimeout(this._reconnectTimeout),this._reconnectTimeout=null,this._reconnectionAttempt=0},f.exports=p},{"../constants/constants":42,"../tcp/tcp-connection":56,"../utils/utils":59,"./message-builder":46,"./message-parser":47,"engine.io-client":10}],46:[function(e,f,n){var o=e("../constants/constants"),d=o.MESSAGE_PART_SEPERATOR;n.getMsg=function(e,f,n){if(n&&!(n instanceof Array))throw new Error("data must be an array");var i,t=[e,f];if(n)for(i=0;i<n.length;i++)"object"==typeof n[i]?t.push(JSON.stringify(n[i])):t.push(n[i]);return t.join(d)+o.MESSAGE_SEPERATOR},n.typed=function(e){var f=typeof e;if("string"===f)return o.TYPES.STRING+e;if(null===e)return o.TYPES.NULL;if("object"===f)return o.TYPES.OBJECT+JSON.stringify(e);if("number"===f)return o.TYPES.NUMBER+e.toString();if(e===!0)return o.TYPES.TRUE;if(e===!1)return o.TYPES.FALSE;if(void 0===e)return o.TYPES.UNDEFINED;throw new Error("Can't serialize type "+e)}},{"../constants/constants":42}],47:[function(e,f,n){var o=e("../constants/constants"),d=function(){this._actions=this._getActions()};d.prototype.parse=function(e,f){var n,d=[],i=e.split(o.MESSAGE_SEPERATOR);for(n=0;n<i.length;n++)i[n].length>2&&d.push(this._parseMessage(i[n],f));return d},d.prototype.convertTyped=function(e,f){var n=e.charAt(0);if(n===o.TYPES.STRING)return e.substr(1);if(n===o.TYPES.OBJECT)try{return JSON.parse(e.substr(1))}catch(d){f._$onError(o.TOPIC.ERROR,o.EVENT.MESSAGE_PARSE_ERROR,d.toString()+"("+e+")")}return n===o.TYPES.NUMBER?parseFloat(e.substr(1)):n===o.TYPES.NULL?null:n===o.TYPES.TRUE?!0:n===o.TYPES.FALSE?!1:n===o.TYPES.UNDEFINED?void 0:void f._$onError(o.TOPIC.ERROR,o.EVENT.MESSAGE_PARSE_ERROR,"UNKNOWN_TYPE ("+e+")")},d.prototype._getActions=function(){var e,f={};for(e in o.ACTIONS)f[o.ACTIONS[e]]=e;return f},d.prototype._parseMessage=function(e,f){var n=e.split(o.MESSAGE_PART_SEPERATOR),d={};return n.length<2?(f._$onError(o.TOPIC.ERROR,o.EVENT.MESSAGE_PARSE_ERROR,"Insufficiant message parts"),null):void 0===this._actions[n[1]]?(f._$onError(o.TOPIC.ERROR,o.EVENT.MESSAGE_PARSE_ERROR,"Unknown action "+n[1]),null):(d.raw=e,d.topic=n[0],d.action=n[1],d.data=n.splice(2),d)},f.exports=new d},{"../constants/constants":42}],48:[function(e,f,n){var o=e("./record"),d=e("component-emitter"),i=function(e){this.name=null,this._recordHandler=e,this._record=null,this._subscriptions=[],this._proxyMethod("delete"),this._proxyMethod("set"),this._proxyMethod("unsubscribe"),this._proxyMethod("discard")};d(i.prototype),i.prototype.get=function(e){return null===this._record?void 0:this._record.get(e)},i.prototype.subscribe=function(){var e=o.prototype._normalizeArguments(arguments);e.triggerNow=!0,this._subscriptions.push(e),null!==this._record&&this._record.subscribe(e)},i.prototype.unsubscribe=function(){var e,f=o.prototype._normalizeArguments(arguments),n=[];for(e=0;e<this._subscriptions.length;e++)(this._subscriptions[e].path!==f.path||this._subscriptions[e].callback!==f.callback)&&n.push(this._subscriptions[e]);this._subscriptions=n,null!==this._record&&this._record.unsubscribe(f)},i.prototype.setName=function(e){this.name=e;var f;if(null!==this._record&&!this._record.isDestroyed){for(f=0;f<this._subscriptions.length;f++)this._record.unsubscribe(this._subscriptions[f]);this._record.discard()}for(this._record=this._recordHandler.getRecord(e),f=0;f<this._subscriptions.length;f++)this._record.subscribe(this._subscriptions[f]);this.emit("nameChanged",e)},i.prototype._proxyMethod=function(e){this[e]=this._callMethodOnRecord.bind(this,e)},i.prototype._callMethodOnRecord=function(e){if(null===this._record)throw new Error("Can`t invoke "+e+". AnonymousRecord not initialised. Call setName first");if("function"!=typeof this._record[e])throw new Error(e+" is not a method on the record");var f=Array.prototype.slice.call(arguments,1);return this._record[e].apply(this._record,f)},f.exports=i},{"./record":52,"component-emitter":6}],49:[function(e,f,n){var o=e("../utils/utils"),d=/[\.\[\]]/g,i="*",t=function(e,f){this._record=e,this._path=String(f),this._tokens=[],this._tokenize()};t.prototype.getValue=function(){var e,f=this._record._$data;for(e=0;e<this._tokens.length;e++){if(void 0===f[this._tokens[e]])return void 0;f=f[this._tokens[e]]}return f},t.prototype.setValue=function(e){var f,n=this._record._$data;for(f=0;f<this._tokens.length-1;f++)n=void 0!==n[this._tokens[f]]?n[this._tokens[f]]:this._tokens[f+1]&&!isNaN(this._tokens[f+1])?n[this._tokens[f]]=[]:n[this._tokens[f]]={};n[this._tokens[f]]=e},t.prototype._tokenize=function(){var e,f,n=this._path.split(d);for(f=0;f<n.length;f++)e=o.trim(n[f]),0!==e.length&&(isNaN(e)?e!==i?this._tokens.push(e):this._tokens.push(!0):this._tokens.push(parseInt(e,10)))},f.exports=t},{"../utils/utils":59}],50:[function(e,f,n){var o=e("component-emitter"),d=e("./record"),i=e("../constants/constants"),t="entry-added",l="entry-removed",u="entry-moved",p=function(e,f,n){this._recordHandler=e,this._record=this._recordHandler.getRecord(f,n),this._record._applyUpdate=this._applyUpdate.bind(this),this._record.on("delete",this.emit.bind(this,"delete")),this._record.on("discard",this.emit.bind(this,"discard")),this._record.on("ready",this._onReady.bind(this)),this.isReady=this._record.isReady,this.name=f,this._queuedMethods=[],this._beforeStructure=null,this._hasAddListener=null,this._hasRemoveListener=null,this._hasMoveListener=null,this["delete"]=this._record["delete"].bind(this._record),this.discard=this._record.discard.bind(this._record),this.whenReady=this._record.whenReady.bind(this._record)};o(p.prototype),p.prototype.getEntries=function(){var e=this._record.get();return e instanceof Array?e:[]},p.prototype.isEmpty=function(){return 0===this.getEntries().length},p.prototype.setEntries=function(e){var f,n="entries must be an array of record names";if(!(e instanceof Array))throw new Error(n);for(f=0;f<e.length;f++)if("string"!=typeof e[f])throw new Error(n);this._record.isReady===!1?this._queuedMethods.push(this.setEntries.bind(this,e)):(this._beforeChange(),this._record.set(e),this._afterChange())},p.prototype.removeEntry=function(e,f){if(this._record.isReady===!1)return void this._queuedMethods.push(this.removeEntry.bind(this,e));var n,o=this._record.get(),d=this._hasIndex(f),i=[];for(n=0;n<o.length;n++)(o[n]!==e||d&&f!==n)&&i.push(o[n]);this._beforeChange(),this._record.set(i),this._afterChange()},p.prototype.addEntry=function(e,f){if("string"!=typeof e)throw new Error("Entry must be a recordName");if(this._record.isReady===!1)return void this._queuedMethods.push(this.addEntry.bind(this,e));var n=this._hasIndex(f),o=this.getEntries();n?o.splice(f,0,e):o.push(e),this._beforeChange(),this._record.set(o),this._afterChange()},p.prototype.subscribe=function(){var e=d.prototype._normalizeArguments(arguments);if(e.path)throw new Error("path is not supported for List.subscribe");this._record.subscribe(e)},p.prototype.unsubscribe=function(){var e=d.prototype._normalizeArguments(arguments);if(e.path)throw new Error("path is not supported for List.unsubscribe");this._record.unsubscribe(e)},p.prototype._onReady=function(){this.isReady=!0;for(var e=0;e<this._queuedMethods.length;e++)this._queuedMethods[e]();this.emit("ready")},p.prototype._applyUpdate=function(e){if(e.action===i.ACTIONS.PATCH)throw new Error("PATCH is not supported for Lists");"["!==e.data[2].charAt(0)&&(e.data[2]="[]"),this._beforeChange(),d.prototype._applyUpdate.call(this._record,e),this._afterChange()},p.prototype._hasIndex=function(e){var f=!1,n=this.getEntries();if(void 0!==e){if(isNaN(e))throw new Error("Index must be a number");if(e!==n.length&&(e>=n.length||0>e))throw new Error("Index must be within current entries");f=!0}return f},p.prototype._beforeChange=function(){this._hasAddListener=this.listeners(t).length>0,this._hasRemoveListener=this.listeners(l).length>0,this._hasMoveListener=this.listeners(u).length>0,this._hasAddListener||this._hasRemoveListener||this._hasMoveListener?this._beforeStructure=this._getStructure():this._beforeStructure=null},p.prototype._afterChange=function(){if(null!==this._beforeStructure){var e,f,n=this._getStructure(),o=this._beforeStructure;if(this._hasRemoveListener)for(e in o)for(f=0;f<o[e].length;f++)(void 0===n[e]||void 0===n[e][f])&&this.emit(l,e,o[e][f]);if(this._hasAddListener||this._hasMoveListener)for(e in n)if(void 0===o[e])for(f=0;f<n[e].length;f++)this.emit(t,e,n[e][f]);else for(f=0;f<n[e].length;f++)o[e][f]!==n[e][f]&&(void 0===o[e][f]?this.emit(t,e,n[e][f]):this.emit(u,e,n[e][f]))}},p.prototype._getStructure=function(){var e,f={},n=this._record.get();for(e=0;e<n.length;e++)void 0===f[n[e]]?f[n[e]]=[e]:f[n[e]].push(e);return f},f.exports=p},{"../constants/constants":42,"./record":52,"component-emitter":6}],51:[function(e,f,n){var o=e("./record"),d=e("./anonymous-record"),i=e("./list"),t=e("../utils/listener"),l=e("../constants/constants"),u=e("component-emitter"),p=function(e,f,n){this._options=e,this._connection=f,this._client=n,this._records={},this._listener={},this._destroyEventEmitter=new u};p.prototype.getRecord=function(e,f){return this._records[e]||(this._records[e]=new o(e,f||{},this._connection,this._options,this._client),this._records[e].on("error",this._onRecordError.bind(this,e)),this._records[e].on("destroyPending",this._onDestroyPending.bind(this,e)),this._records[e].on("deleted",this._removeRecord.bind(this,e)),this._records[e].on("discard",this._removeRecord.bind(this,e))),this._records[e].usages++,this._records[e]},p.prototype.getList=function(e,f){return new i(this,e,f)},p.prototype.getAnonymousRecord=function(){return new d(this)},p.prototype.listen=function(e,f){this._listener[e]?this._client._$onError(l.TOPIC.RECORD,l.EVENT.LISTENER_EXISTS,e):this._listener[e]=new t(l.TOPIC.RECORD,e,f,this._options,this._client,this._connection)},p.prototype.unlisten=function(e){this._listener[e]?(this._listener[e].destroy(),delete this._listener[e]):this._client._$onError(l.TOPIC.RECORD,l.EVENT.NOT_LISTENING,e)},p.prototype._$handle=function(e){var f;if(e.action===l.ACTIONS.ERROR&&e.data[0]!==l.EVENT.VERSION_EXISTS)return void this._client._$onError(l.TOPIC.RECORD,e.data[0],e.data[1]);if(e.action===l.ACTIONS.ACK||e.action===l.ACTIONS.ERROR){if(f=e.data[1],e.data[0]===l.ACTIONS.DELETE||e.data[0]===l.ACTIONS.UNSUBSCRIBE)return this._destroyEventEmitter.emit("destroy_ack_"+f,e),void(e.data[0]===l.ACTIONS.DELETE&&this._records[f]&&this._records[f]._$onMessage(e))}else f=e.data[0];this._records[f]?this._records[f]._$onMessage(e):this._listener[f]?this._listener[f]._$onMessage(e):this._client._$onError(l.TOPIC.RECORD,l.EVENT.UNSOLICITED_MESSAGE,f)},p.prototype._onRecordError=function(e,f){this._client._$onError(l.TOPIC.RECORD,f,e)},p.prototype._onDestroyPending=function(e){var f=this._records[e]._$onMessage.bind(this._records[e]);this._destroyEventEmitter.once("destroy_ack_"+e,f),this._removeRecord(e)},p.prototype._removeRecord=function(e){delete this._records[e]},f.exports=p},{"../constants/constants":42,"../utils/listener":58,"./anonymous-record":48,"./list":50,"./record":52,"component-emitter":6}],52:[function(e,f,n){var o=e("./json-path"),d=e("../utils/utils"),i=e("component-emitter"),t=e("../constants/constants"),l=e("../message/message-builder"),u=e("../message/message-parser"),p="ALL_EVENT",s=function(e,f,n,o,d){this.name=e,this.usages=0,this._recordOptions=f,this._connection=n,this._client=d,this._options=o,this.isReady=!1,this.isDestroyed=!1,this._$data={},this._version=null,this._paths={},this._oldValue=null,this._oldPathValues=null,this._eventEmitter=new i,this._queuedMethodCalls=[],this._isReconnecting=!1,this._connectionStateChangeHandler=this._handleConnectionStateChanges.bind(this),this._readAckTimeout=setTimeout(this._onTimeout.bind(this,t.EVENT.ACK_TIMEOUT),this._options.recordReadAckTimeout),this._readTimeout=setTimeout(this._onTimeout.bind(this,t.EVENT.RESPONSE_TIMEOUT),this._options.recordReadTimeout),this._sendRead()};i(s.prototype),s.prototype.get=function(e){var f;return f=e?this._getPath(e).getValue():this._$data,d.shallowCopy(f)},s.prototype.set=function(e,f){if(1===arguments.length&&"object"!=typeof e)throw new Error("Invalid record data "+e+": Record data must be an object");if(!this._checkDestroyed("set"))return this.isReady?void(2===arguments.length&&d.deepEquals(this._getPath(e).getValue(),f)||1===arguments.length&&d.deepEquals(this._$data,e)||(this._beginChange(),this._version++,1===arguments.length?(this._$data=e,this._connection.sendMsg(t.TOPIC.RECORD,t.ACTIONS.UPDATE,[this.name,this._version,this._$data])):(this._getPath(e).setValue(f),this._connection.sendMsg(t.TOPIC.RECORD,t.ACTIONS.PATCH,[this.name,this._version,e,l.typed(f)])),this._completeChange())):void this._queuedMethodCalls.push({method:"set",args:arguments})},s.prototype.subscribe=function(e,f,n){var o=this._normalizeArguments(arguments);this._checkDestroyed("subscribe")||(this._eventEmitter.on(o.path||p,o.callback),o.triggerNow&&this.isReady&&(o.path?o.callback(this._getPath(o.path).getValue()):o.callback(this._$data)))},s.prototype.unsubscribe=function(e,f){if(!this._checkDestroyed("unsubscribe")){var n=2===arguments.length?e:p;this._eventEmitter.off(n,f)}},s.prototype.discard=function(){this.usages--,this.usages<=0&&(this.emit("destroyPending"),this._discardTimeout=setTimeout(this._onTimeout.bind(this,t.EVENT.ACK_TIMEOUT),this._options.subscriptionTimeout),this._connection.sendMsg(t.TOPIC.RECORD,t.ACTIONS.UNSUBSCRIBE,[this.name]))},s.prototype["delete"]=function(){this._checkDestroyed("delete")||(this.emit("destroyPending"),this._deleteAckTimeout=setTimeout(this._onTimeout.bind(this,t.EVENT.DELETE_TIMEOUT),this._options.recordDeleteTimeout),this._connection.sendMsg(t.TOPIC.RECORD,t.ACTIONS.DELETE,[this.name]))},s.prototype.whenReady=function(e){this.isReady===!0?e(this):this.once("ready",e.bind(this,this))},s.prototype._$onMessage=function(e){e.action===t.ACTIONS.READ?(this._clearTimeouts(),this._onRead(e)):e.action===t.ACTIONS.ACK?this._processAckMessage(e):e.action===t.ACTIONS.UPDATE||e.action===t.ACTIONS.PATCH?this._applyUpdate(e):e.data[0]===t.EVENT.VERSION_EXISTS&&this._recoverRecord()},s.prototype._recoverRecord=function(){},s.prototype._processAckMessage=function(e){var f=e.data[0];f===t.ACTIONS.SUBSCRIBE?clearTimeout(this._readAckTimeout):f===t.ACTIONS.DELETE?(this.emit("delete"),this._destroy()):f===t.ACTIONS.UNSUBSCRIBE&&(this.emit("discard"),this._destroy())},s.prototype._applyUpdate=function(e){var f=parseInt(e.data[1],10);null===this._version?this._version=f:this._version+1!==f&&this.emit("error","received update for "+f+" but version is "+this._version),this._beginChange(),this._version=f,e.action===t.ACTIONS.UPDATE?this._$data=JSON.parse(e.data[2]):this._getPath(e.data[2]).setValue(u.convertTyped(e.data[3])),this._completeChange()},s.prototype._onRead=function(e){this._beginChange(),this._version=parseInt(e.data[1],10),this._$data=JSON.parse(e.data[2]),this._setReady(),this._completeChange()},s.prototype._setReady=function(){this.isReady=!0,this._client.on("connectionStateChanged",this._connectionStateChangeHandler);for(var e=0;e<this._queuedMethodCalls.length;e++)this[this._queuedMethodCalls[e].method].apply(this,this._queuedMethodCalls[e].args);this._queuedMethodCalls=[],this.emit("ready")},s.prototype._sendRead=function(){this._connection.sendMsg(t.TOPIC.RECORD,t.ACTIONS.CREATEORREAD,[this.name])},s.prototype._handleConnectionStateChanges=function(){var e=this._client.getConnectionState();e===t.CONNECTION_STATE.RECONNECTING&&this._isReconnecting===!1&&(this._sendRead(),this._isReconnecting=!0),e===t.CONNECTION_STATE.OPEN&&this._isReconnecting===!0&&(this._isReconnecting=!1)},s.prototype._getPath=function(e){return this._paths[e]||(this._paths[e]=new o(this,e)),this._paths[e]},s.prototype._beginChange=function(){if(this._eventEmitter._callbacks){var e,f=Object.keys(this._eventEmitter._callbacks);for(this._oldPathValues={},this._eventEmitter.hasListeners(p)&&(this._oldValue=this.get()),e=0;e<f.length;e++)f[e]!==p&&(this._oldPathValues[f[e]]=this._getPath(f[e]).getValue())}},s.prototype._completeChange=function(){if(this._eventEmitter.hasListeners(p)&&!d.deepEquals(this._oldValue,this._$data)&&this._eventEmitter.emit(p,this.get()),this._oldValue=null,null!==this._oldPathValues){var e,f;for(e in this._oldPathValues)f=this._getPath(e).getValue(),f!==this._oldPathValues[e]&&this._eventEmitter.emit(e,f);this._oldPathValues=null}},s.prototype._normalizeArguments=function(e){var f,n={};if(1===e.length&&"object"==typeof e[0])return e[0];for(f=0;f<e.length;f++)"string"==typeof e[f]?n.path=e[f]:"function"==typeof e[f]?n.callback=e[f]:"boolean"==typeof e[f]&&(n.triggerNow=e[f]);return n},s.prototype._clearTimeouts=function(){clearTimeout(this._readAckTimeout),clearTimeout(this._readTimeout),clearTimeout(this._deleteAckTimeout),clearTimeout(this._discardTimeout)},s.prototype._checkDestroyed=function(e){return this.isDestroyed?(this.emit("error","Can't invoke '"+e+"'. Record '"+this.name+"' is already destroyed"),!0):!1},s.prototype._onTimeout=function(e){this._clearTimeouts(),this.emit("error",e)},s.prototype._destroy=function(){this._clearTimeouts(),this._eventEmitter.off(),this._client.off("connectionStateChanged",this._connectionStateChangeHandler),this.isDestroyed=!0,this.isReady=!1,this._client=null,this._eventEmitter=null,this._connectionStateChangeHandler=null,this._connection=null},f.exports=s},{"../constants/constants":42,"../message/message-builder":46,"../message/message-parser":47,"../utils/utils":59,"./json-path":49,"component-emitter":6}],53:[function(e,f,n){var o=e("../constants/constants"),d=e("./rpc-response"),i=e("./rpc"),t=e("../message/message-parser"),l=e("../message/message-builder"),u=function(e,f,n){this._options=e,this._connection=f,this._client=n,this._rpcs={},this._providers={},this._provideAckTimeouts={}};u.prototype.provide=function(e,f){if(this._providers[e])throw new Error("rpc "+e+" already registered");this._providers[e]=f,this._provideAckTimeouts[e]=setTimeout(this._provideTimedOut.bind(this,e),this._options.subscriptionTimeout),this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.SUBSCRIBE,[e])},u.prototype.unprovide=function(e){this._providers[e]&&(delete this._providers[e],this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.UNSUBSCRIBE,[e]))},u.prototype.make=function(e,f,n){var d=this._client.getUid(),t=l.typed(f);this._rpcs[d]=new i(this._options,n,this._client),this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.REQUEST,[e,d,t])},u.prototype._getRpc=function(e,f,n){var d=this._rpcs[e];return d?d:(this._client._$onError(o.TOPIC.RPC,o.EVENT.UNSOLICITED_MESSAGE,n),null)},u.prototype._respondToRpc=function(e){var f,n=e.data[0],i=e.data[1],l=null;e.data[2]&&(l=t.convertTyped(e.data[2],this._client)),this._providers[n]?(f=new d(this._connection,n,i),this._providers[n](l,f)):this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.REJECTION,[n,i])},u.prototype._provideTimedOut=function(e){this._client._$onError(o.TOPIC.RPC,o.EVENT.ACK_TIMEOUT,"rpc:"+e)},u.prototype._$handle=function(e){var f,n,d;return e.action===o.ACTIONS.REQUEST?void this._respondToRpc(e):e.action===o.ACTIONS.ACK&&e.data[0]===o.ACTIONS.SUBSCRIBE?void clearTimeout(this._provideAckTimeouts[e.data[1]]):(e.action===o.ACTIONS.ERROR?(f=e.data[1],n=e.data[2]):(f=e.data[0],n=e.data[1]),d=this._getRpc(n,f,e.raw),void(null!==d&&(e.action===o.ACTIONS.ACK?d.ack():e.action===o.ACTIONS.RESPONSE?(d.respond(e.data[2]),delete this._rpcs[n]):e.action===o.ACTIONS.ERROR&&(e.processedError=!0,d.error(e.data[0]),delete this._rpcs[n]))))},f.exports=u},{"../constants/constants":42,"../message/message-builder":46,"../message/message-parser":47,"./rpc":55,"./rpc-response":54}],54:[function(e,f,n){var o=e("../constants/constants"),d=e("../utils/utils"),i=e("../message/message-builder"),t=function(e,f,n){this._connection=e,this._name=f,this._correlationId=n,this._isAcknowledged=!1,this._isComplete=!1,this.autoAck=!0,d.nextTick(this._performAutoAck.bind(this))};t.prototype.ack=function(){this._isAcknowledged===!1&&(this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.ACK,[this._name,this._correlationId]),this._isAcknowledged=!0)},t.prototype.reject=function(){this.autoAck=!1,this._isComplete=!0,this._isAcknowledged=!0,this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.REJECTION,[this._name,this._correlationId])},t.prototype.error=function(e){this.autoAck=!1,this._isComplete=!0,this._isAcknowledged=!0,this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.ERROR,[e,this._name,this._correlationId])},t.prototype.send=function(e){if(this._isComplete===!0)throw new Error("Rpc "+this._name+" already completed");var f=i.typed(e);this._connection.sendMsg(o.TOPIC.RPC,o.ACTIONS.RESPONSE,[this._name,this._correlationId,f]),this._isComplete=!0},t.prototype._performAutoAck=function(){this.autoAck===!0&&this.ack()},f.exports=t},{"../constants/constants":42,"../message/message-builder":46,"../utils/utils":59}],55:[function(e,f,n){var o=e("../constants/constants"),d=e("../message/message-parser"),i=function(e,f,n){this._options=e,this._callback=f,this._client=n,this._ackTimeout=setTimeout(this.error.bind(this,o.EVENT.ACK_TIMEOUT),this._options.rpcAckTimeout),this._responseTimeout=setTimeout(this.error.bind(this,o.EVENT.RESPONSE_TIMEOUT),this._options.rpcResponseTimeout)};i.prototype.ack=function(){clearTimeout(this._ackTimeout)},i.prototype.respond=function(e){var f=d.convertTyped(e,this._client);this._callback(null,f),this._complete()},i.prototype.error=function(e){this._callback(e),this._complete()},i.prototype._complete=function(){clearTimeout(this._ackTimeout),clearTimeout(this._responseTimeout)},f.exports=i},{"../constants/constants":42,"../message/message-parser":47}],56:[function(e,f,n){(function(n){var o=e("net"),d=e("url"),i=e("events"),t=e("util"),l=e("../constants/constants"),u=function(e){this._socket=null,this._url=e,this._messageBuffer="",this._destroyFn=this._destroy.bind(this),n.on("exit",this._destroyFn),this.open(),this._isOpen=!1};t.inherits(u,i.EventEmitter),u.prototype.open=function(){this._socket=o.createConnection(this._getOptions()),this._socket.setEncoding("utf8"),this._socket.setKeepAlive(!0,5e3),this._socket.setNoDelay(!0),this._socket.on("data",this._onData.bind(this)),this._socket.on("error",this._onError.bind(this)),this._socket.on("connect",this._onConnect.bind(this)),this._socket.on("close",this._onClose.bind(this))},u.prototype.send=function(e){this._isOpen===!0?this._socket.write(e):this.emit("error","attempt to send message on closed socket: "+e)},u.prototype.close=function(){this._isOpen=!1,n.removeListener("exit",this._destroyFn),this._socket.end()},u.prototype._onError=function(e){var f;f="ECONNREFUSED"===e.code?"Can't connect! Deepstream server unreachable on "+this._url:e.toString(),this.emit("error",f)},u.prototype._onConnect=function(){this._isOpen=!0,this.emit("open")},u.prototype._onClose=function(){this._isOpen=!1,this.emit("close")},u.prototype._onData=function(e){if("string"!=typeof e)return void this.emit("error","received non-string message from socket");if(this._isOpen===!1)return void this.emit("error","received message on half closed socket: "+e);var f;return e.charAt(e.length-1)!==l.MESSAGE_SEPERATOR?void(this._messageBuffer+=e):(0!==this._messageBuffer.length?(f=this._messageBuffer+e,this._messageBuffer=""):f=e,void this.emit("message",f))},u.prototype._getOptions=function(){var e={};return-1===this._url.indexOf("/")?(e.hostname=this._url.split(":")[0],e.port=this._url.split(":")[1]):e=d.parse(this._url),{host:e.hostname,
port:parseInt(e.port,10),allowHalfOpen:!1}},u.prototype._destroy=function(){this._socket.destroy()},f.exports=u}).call(this,e("_process"))},{"../constants/constants":42,_process:31,events:22,net:5,url:36,util:39}],57:[function(e,f,n){var o=e("../constants/constants"),d=e("component-emitter"),i=function(e,f,n){this._client=e,this._topic=f,this._timeoutDuration=n,this._register={}};d(i.prototype),i.prototype.add=function(e){if(this._register[e])throw new Error("Timeout "+e+" is already registered");this._register[e]=setTimeout(this._onTimeout.bind(this,e),this._timeoutDuration)},i.prototype.clear=function(e){var f=e.data[1];this._register[f]?(clearTimeout(this._register[f]),delete this._register[f]):this._client._$onError(this._topic,o.EVENT.UNSOLICITED_MESSAGE,e.raw)},i.prototype._onTimeout=function(e){delete this._register[e];var f="No ACK message received in time for "+e;this._client._$onError(this._topic,o.EVENT.ACK_TIMEOUT,f),this.emit("timeout",e)},f.exports=i},{"../constants/constants":42,"component-emitter":6}],58:[function(e,f,n){var o=e("../constants/constants"),d=function(e,f,n,d,i,t){this._type=e,this._callback=n,this._pattern=f,this._options=d,this._client=i,this._connection=t,this._ackTimeout=setTimeout(this._onAckTimeout.bind(this),this._options.subscriptionTimeout),this._connection.sendMsg(this._type,o.ACTIONS.LISTEN,[this._pattern])};d.prototype.destroy=function(){this._connection.sendMsg(this._type,o.ACTIONS.UNLISTEN,[this._pattern]),this._callback=null,this._pattern=null,this._client=null,this._connection=null},d.prototype._$onMessage=function(e){if(e.action===o.ACTIONS.ACK)clearTimeout(this._ackTimeout);else{var f=e.action===o.ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND;this._callback(e.data[1],f)}},d.prototype._onAckTimeout=function(){this._client._$onError(this._type,o.EVENT.ACK_TIMEOUT,"Listening to pattern "+this._pattern)},f.exports=d},{"../constants/constants":42}],59:[function(e,f,n){(function(e){n.isNode=function(){return"undefined"!=typeof e&&"[object process]"===e.toString()},n.nextTick=function(f){n.isNode()?e.nextTick(f):setTimeout(f,0)},n.trim=function(e){return e.trim?e.trim():e.replace(f,"")};var f=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o="object";n.deepEquals=function(e,f){var n,d=!0;return null===e||null===f?e===f:typeof e!==o||typeof f!==o?e===f:(n=function(i,t){if(null===i||null===t||typeof i!==o||typeof t!==o)return void(d=e===f);for(var l in i)if(typeof i[l]===o)n(i[l],t[l]);else if(i[l]!==t[l])return void(d=!1)},n(e,f),d&&n(f,e),d)},n.shallowCopy=function(e){if(typeof e!==o)return e;var f,n;if(e instanceof Array)for(f=[],n=0;n<e.length;n++)f[n]=e[n];else{f={};for(n in e)f[n]=e[n]}return f}}).call(this,e("_process"))},{_process:31}],60:[function(e,f,n){var o=e("./webrtc-connection"),d=e("component-emitter"),i=e("../constants/constants"),t=function(e,f){this._connection=e.connection,this._localId=e.localId,this._remoteId=e.remoteId,this._localStream=e.localStream,this._offer=e.offer,this._$webRtcConnection=null,this._bufferedIceCandidates=[],this._options=f,this.state=i.CALL_STATE.INITIAL,this.metaData=e.metaData||null,this.callee=e.isOutgoing?e.remoteId:e.localId,this.isOutgoing=e.isOutgoing,this.isIncoming=!e.isOutgoing,this.isAccepted=!1,this.isDeclined=!1,this.isOutgoing&&this._initiate()};d(t.prototype),t.prototype.accept=function(e){if(this.isAccepted)throw new Error("Incoming call is already accepted");if(this.isDeclined)throw new Error("Can't accept incoming call. Call was already declined");this.isAccepted=!0,this._$webRtcConnection=new o(this._connection,this._options,this._localId,this._remoteId),e&&this._$webRtcConnection.addStream(e),this._$webRtcConnection.setRemoteDescription(new RTCSessionDescription(this._offer)),this._$webRtcConnection.createAnswer(),this._$webRtcConnection.on("stream",this._onEstablished.bind(this)),this._$webRtcConnection.on("error",this.emit.bind(this,"error"));for(var f=0;f<this._bufferedIceCandidates.length;f++)this._$webRtcConnection.addIceCandidate(this._bufferedIceCandidates[f]);this._bufferedIceCandidates=[],this._stateChange(i.CALL_STATE.ACCEPTED)},t.prototype.decline=function(e){if(this.isAccepted)throw new Error("Can't decline incoming call. Call was already accepted");if(this.isDeclined)throw new Error("Incoming call was already declined");this.isDeclined=!0,this._connection.sendMsg(i.TOPIC.WEBRTC,i.ACTIONS.WEBRTC_CALL_DECLINED,[this._localId,this._remoteId,e||null]),this._$declineReceived(e||null)},t.prototype.end=function(){this._connection.sendMsg(i.TOPIC.WEBRTC,i.ACTIONS.WEBRTC_CALL_ENDED,[this._localId,this._remoteId,null]),this._$close()},t.prototype._$close=function(){this._stateChange(i.CALL_STATE.ENDED),this._$webRtcConnection&&this._$webRtcConnection.close(),this.emit("ended")},t.prototype._$addIceCandidate=function(e){this.isIncoming&&this.isAccepted===!1?this._bufferedIceCandidates.push(e):this._$webRtcConnection.addIceCandidate(e)},t.prototype._$declineReceived=function(e){this.isDeclined=!0,this.isAccepted=!1,this._stateChange(i.CALL_STATE.DECLINED),this.emit("declined",e)},t.prototype._stateChange=function(e){this.state=e,this.emit("stateChange",e)},t.prototype._initiate=function(){this._stateChange(i.CALL_STATE.CONNECTING),this._$webRtcConnection=new o(this._connection,this._options,this._localId,this._remoteId),this._$webRtcConnection.initiate(this._localStream,this.metaData),this._$webRtcConnection.on("stream",this._onEstablished.bind(this))},t.prototype._onEstablished=function(e){this.isDeclined=!1,this.isAccepted=!0,this._stateChange(i.CALL_STATE.ESTABLISHED),this.emit("established",e)},f.exports=t},{"../constants/constants":42,"./webrtc-connection":61,"component-emitter":6}],61:[function(e,f,n){var o=e("component-emitter"),d=e("../constants/constants"),i=function(){},t=function(e,f,n,o){this._connection=e,this._remoteId=o,this._localId=n,this._peerConnection=new RTCPeerConnection(f.rtcPeerConnectionConfig),this._peerConnection.onaddstream=this._onStream.bind(this),this._peerConnection.onicecandidate=this._onIceCandidate.bind(this),this._peerConnection.oniceconnectionstatechange=this._onIceConnectionStateChange.bind(this),this._constraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}};o(t.prototype),t.prototype.initiate=function(e,f){this._peerConnection.addStream(e),this._peerConnection.createOffer(this._onOfferCreated.bind(this,f),this._onError.bind(this))},t.prototype.close=function(){this._peerConnection.close()},t.prototype.addStream=function(e){this._peerConnection.addStream(e)},t.prototype.setRemoteDescription=function(e){this._peerConnection.setRemoteDescription(e,i,this._onError.bind(this))},t.prototype.createAnswer=function(){this._peerConnection.createAnswer(this._onAnswerCreated.bind(this),this._onError.bind(this),this._constraints)},t.prototype.addIceCandidate=function(e){this._peerConnection.addIceCandidate(e,i,this._onError.bind(this))},t.prototype._onStream=function(e){this.emit("stream",e.stream)},t.prototype._onOfferCreated=function(e,f){this._sendMsg(d.ACTIONS.WEBRTC_OFFER,JSON.stringify({sdp:f.sdp,type:f.type,meta:e})),this._peerConnection.setLocalDescription(f,i,this._onError.bind(this))},t.prototype._onAnswerCreated=function(e){this._sendMsg(d.ACTIONS.WEBRTC_ANSWER,e.toJSON()),this._peerConnection.setLocalDescription(e,i,this._onError.bind(this))},t.prototype._sendMsg=function(e,f){this._connection.sendMsg(d.TOPIC.WEBRTC,e,[this._localId,this._remoteId,f])},t.prototype._onIceCandidate=function(e){e.candidate&&this._sendMsg(d.ACTIONS.WEBRTC_ICE_CANDIDATE,e.candidate.toJSON())},t.prototype._onIceConnectionStateChange=function(){"disconnected"===this._peerConnection.iceConnectionState&&this._connection.sendMsg(d.TOPIC.WEBRTC,d.ACTIONS.WEBRTC_IS_ALIVE,[this._remoteId])},t.prototype._onError=function(e){this.emit("error",e)},f.exports=t},{"../constants/constants":42,"component-emitter":6}],62:[function(e,f,n){var o=e("../constants/constants"),d=(e("./webrtc-connection"),e("./webrtc-call")),i=e("../utils/ack-timeout-registry"),t="callee-update",l=function(e,f,n){this._options=e,this._connection=f,this._client=n,this._localCallees={},this._remoteCallees=[],this._remoteCalleesCallback=null,this._ackTimeoutRegistry=new i(n,o.TOPIC.WEBRTC,this._options.calleeAckTimeout),this._ackTimeoutRegistry.on("timeout",this._removeCallee.bind(this)),this._calls={}};l.prototype.registerCallee=function(e,f){if(this._checkCompatibility(),"string"!=typeof e)throw new Error("Invalid callee name "+e);if("function"!=typeof f)throw new Error("Callback is not a function");if(this._localCallees[e])throw new Error("Callee "+e+" is already registered");this._localCallees[e]=f,this._ackTimeoutRegistry.add(e),this._connection.sendMsg(o.TOPIC.WEBRTC,o.ACTIONS.WEBRTC_REGISTER_CALLEE,[e])},l.prototype.unregisterCallee=function(e){if(!this._localCallees[e])throw new Error("Callee is not registered");this._removeCallee(e),this._ackTimeoutRegistry.add(e),this._connection.sendMsg(o.TOPIC.WEBRTC,o.ACTIONS.WEBRTC_UNREGISTER_CALLEE,[e])},l.prototype.makeCall=function(e,f,n){if(this._checkCompatibility(),"string"!=typeof e)throw new Error("Callee must be provided as string");if("object"!=typeof f)throw new Error("metaData must be provided");if(this._calls[e])throw new Error("Call with "+e+" is already in progress");var o=this._client.getUid();return this._ackTimeoutRegistry.add(o),this._createCall(e,{isOutgoing:!0,connection:this._connection,localId:o,remoteId:e,localStream:n,offer:null,metaData:f})},l.prototype.listenForCallees=function(e){if(null!==this._remoteCalleesCallback)throw new Error("Already listening for callees");this._remoteCalleesCallback=e,this._ackTimeoutRegistry.add(t),this._connection.sendMsg(o.TOPIC.WEBRTC,o.ACTIONS.WEBRTC_LISTEN_FOR_CALLEES)},l.prototype.unlistenForCallees=function(){if(!this._remoteCalleesCallback)throw new Error("Not listening for callees");this._remoteCalleesCallback=null,this._ackTimeoutRegistry.add(t),this._connection.sendMsg(o.TOPIC.WEBRTC,o.ACTIONS.WEBRTC_UNLISTEN_FOR_CALLEES)},l.prototype._handleIncomingCall=function(e){var f=e.data[0],n=e.data[1],o=JSON.parse(e.data[2]),d=this._createCall(f,{isOutgoing:!1,connection:this._connection,localId:n,remoteId:f,localStream:null,metaData:o.meta,offer:o});this._localCallees[n](d,o.meta)},l.prototype._removeCall=function(e){delete this._calls[e]},l.prototype._createCall=function(e,f){return this._calls[e]=new d(f,this._options),this._calls[e].on("ended",this._removeCall.bind(this,e)),this._calls[e]},l.prototype._isValidMessage=function(e){return 3===e.data.length&&"string"==typeof e.data[0]&&"string"==typeof e.data[1]&&"string"==typeof e.data[2]},l.prototype._isCalleeUpdate=function(e){return e.action===o.ACTIONS.WEBRTC_ALL_CALLEES||e.action===o.ACTIONS.WEBRTC_CALLEE_ADDED||e.action===o.ACTIONS.WEBRTC_CALLEE_REMOVED},l.prototype._checkCompatibility=function(){if("undefined"==typeof RTCPeerConnection||"undefined"==typeof RTCSessionDescription||"undefined"==typeof RTCIceCandidate){var e="RTC global objects not detected. \n";throw e+="deepstream expects a standardized WebRtc implementation (e.g. no vendor prefixes etc.) \n",e+="until WebRtc is fully supported, we recommend including the official WebRTC adapter script \n",e+="which can be found at https://github.com/webrtc/adapter",new Error(e)}},l.prototype._removeCallee=function(e){delete this._localCallees[e]},l.prototype._processCalleeUpdate=function(e){if(null===this._remoteCalleesCallback)return void this._client._$onError(o.TOPIC.WEBRTC,o.EVENT.UNSOLICITED_MESSAGE,e.raw);e.action===o.ACTIONS.WEBRTC_ALL_CALLEES&&(this._remoteCallees=e.data);var f=this._remoteCallees.indexOf(e.data[0]);if(e.action===o.ACTIONS.WEBRTC_CALLEE_ADDED){if(-1!==f)return;this._remoteCallees.push(e.data[0])}else if(e.action===o.ACTIONS.WEBRTC_CALLEE_REMOVED){if(-1===f)return;this._remoteCallees.splice(f,1)}this._remoteCalleesCallback(this._remoteCallees)},l.prototype._$handle=function(e){var f,n,d;return e.action===o.ACTIONS.ERROR?void this._client._$onError(o.TOPIC.WEBRTC,e.data[0],e.data[1]):e.action===o.ACTIONS.ACK?void this._ackTimeoutRegistry.clear(e):this._isCalleeUpdate(e)?void this._processCalleeUpdate(e):e.action===o.ACTIONS.WEBRTC_IS_ALIVE?void("false"===e.data[1]&&this._calls[e.data[0]]&&this._calls[e.data[0]]._$close()):this._isValidMessage(e)?e.action===o.ACTIONS.WEBRTC_OFFER?void this._handleIncomingCall(e):(f=this._calls[e.data[0]]||this._calls[e.data[1]])?e.action===o.ACTIONS.WEBRTC_ANSWER?(n=new RTCSessionDescription(JSON.parse(e.data[2])),void f._$webRtcConnection.setRemoteDescription(n)):e.action===o.ACTIONS.WEBRTC_ICE_CANDIDATE?(d=new RTCIceCandidate(JSON.parse(e.data[2])),void f._$addIceCandidate(d)):e.action===o.ACTIONS.WEBRTC_CALL_DECLINED?void f._$declineReceived(e.data[2]):e.action===o.ACTIONS.WEBRTC_CALL_ENDED?void f._$close():void this._client._$onError(o.TOPIC.WEBRTC,o.EVENT.EVENT.MESSAGE_PARSE_ERROR,"unsupported action "+e.action):void this._client._$onError(o.TOPIC.WEBRTC,o.EVENT.UNSOLICITED_MESSAGE,e.raw):void this._client._$onError(o.TOPIC.WEBRTC,o.EVENT.MESSAGE_PARSE_ERROR,e)},f.exports=l},{"../constants/constants":42,"../utils/ack-timeout-registry":57,"./webrtc-call":60,"./webrtc-connection":61}]},{},[41])(41)});